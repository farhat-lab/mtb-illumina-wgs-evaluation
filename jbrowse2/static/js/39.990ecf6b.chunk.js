(this["webpackJsonp@jbrowse/web"]=this["webpackJsonp@jbrowse/web"]||[]).push([[39,49],{1334:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return j}));var n=r(104),a=r(87),i=r.n(a),c=r(91),u=r(86),s=r(90),o=r(93),f=r(95),d=r(770),h=r(127),g=r(84),p=r(129),v=r(140),l=r(1078),b=r(81),_=r(88),m=r(101),k=r(364),O=function(){function e(t,r,n){Object(u.a)(this,e),this.record=void 0,this.adapter=void 0,this.ref=void 0,this.record=t,this.adapter=r,this.ref=n}return Object(s.a)(e,[{key:"_get_name",value:function(){return this.record.get("name")}},{key:"_get_type",value:function(){return"match"}},{key:"_get_score",value:function(){return this.record.get("mq")}},{key:"_get_flags",value:function(){return this.record.flags}},{key:"_get_strand",value:function(){return this.record.isReverseComplemented()?-1:1}},{key:"_get_read_group_id",value:function(){return this.record.readGroupId}},{key:"_get_pair_orientation",value:function(){return this.record.isPaired()?this.record.getPairOrientation():void 0}},{key:"_get_next_seq_id",value:function(){return this.record._next_refid()}},{key:"_get_seq_id",value:function(){return this.record._refID}},{key:"_get_next_refName",value:function(){return this.adapter.refIdToName(this.record._next_refid())}},{key:"_get_next_segment_position",value:function(){return this.record.isPaired()?"".concat(this.adapter.refIdToName(this.record._next_refid()),":").concat(this.record._next_pos()+1):void 0}},{key:"_get_seq",value:function(){return this.record.getReadBases()}},{key:"_get_MD",value:function(){var e=this.record.get("MD"),t=this.get("seq");return!e&&t&&this.ref?Object(k.generateMD)(this.ref,this.record.getReadBases(),this.get("CIGAR")):e}},{key:"qualRaw",value:function(){return this.record.qualRaw()}},{key:"set",value:function(){}},{key:"tags",value:function(){var t=Object.getOwnPropertyNames(e.prototype);return Object(m.a)(new Set(t.filter((function(e){return e.startsWith("_get_")&&"_get_mismatches"!==e&&"_get_skips_and_dels"!==e&&"_get_cram_read_features"!==e&&"_get_tags"!==e&&"_get_next_seq_id"!==e&&"_get_seq_id"!==e})).map((function(e){return e.replace("_get_","")})).concat(this.record._tags())))}},{key:"id",value:function(){return"".concat(this.adapter.id,"-").concat(this.record.id())}},{key:"get",value:function(e){var t="_get_".concat(e);return this[t]?this[t]():this.record.get(e)}},{key:"_get_refName",value:function(){return this.adapter.refIdToName(this.record.seq_id())}},{key:"parent",value:function(){}},{key:"children",value:function(){}},{key:"pairedFeature",value:function(){return!1}},{key:"toJSON",value:function(){var e=this,t=Object.fromEntries(this.tags().map((function(t){return[t,e.get(t)]})).filter((function(e){return void 0!==e[1]})));return Object(_.a)(Object(_.a)({},t),{},{uniqueId:this.id()})}},{key:"_get_skips_and_dels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cigarAttributeName:"CIGAR"},t=e.cigarAttributeName,r=[],n=[],a=this.get(t);return a&&(n=Object(k.parseCigar)(a),r=r.concat(Object(k.cigarToMismatches)(n,this.get("seq"),this.qualRaw()))),r}},{key:"_get_mismatches",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cigarAttributeName,r=void 0===t?"CIGAR":t,n=e.mdAttributeName,a=void 0===n?"MD":n,i=[],c=[],u=this.get(r);u&&(c=Object(k.parseCigar)(u),i=i.concat(Object(k.cigarToMismatches)(c,this.get("seq"),this.qualRaw())));var s=this.get(a);s&&(i=i.concat(Object(k.mdToMismatches)(s,c,i,this.get("seq"),this.qualRaw())));var o={};return i.filter((function(e){var t="".concat(e.type,",").concat(e.start,",").concat(e.length),r=o[t];return o[t]=!0,!r}))}},{key:"_get_clipPos",value:function(){var e=this.get("CIGAR")||"";return-1===this.get("strand")?+(e.match(/(\d+)[SH]$/)||[])[1]||0:+(e.match(/^(\d+)([SH])/)||[])[1]||0}}]),e}(),j=function(e){Object(o.a)(r,e);var t=Object(f.a)(r);function r(){var e;Object(u.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).samHeader=void 0,e.setupP=void 0,e.configured=void 0,e}return Object(s.a)(r,[{key:"configure",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t,r,n,a,c,u,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.configured||(t=Object(b.readConfObject)(this.config,"bamLocation"),r=Object(b.readConfObject)(this.config,["index","location"]),n=Object(b.readConfObject)(this.config,["index","indexType"]),a=Object(b.readConfObject)(this.config,"chunkSizeLimit"),c=Object(b.readConfObject)(this.config,"fetchSizeLimit"),u=new d.BamFile({bamFilehandle:Object(p.openLocation)(t),csiFilehandle:"CSI"===n?Object(p.openLocation)(r):void 0,baiFilehandle:"CSI"!==n?Object(p.openLocation)(r):void 0,chunkSizeLimit:a,fetchSizeLimit:c}),(s=Object(b.readConfObject)(this.config,"sequenceAdapter"))&&this.getSubAdapter?this.configured=this.getSubAdapter(s).then((function(e){var t=e.dataAdapter;return{bam:u,sequenceAdapter:t}})):this.configured=Promise.resolve({bam:u})),e.abrupt("return",this.configured);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var r,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:return r=e.sent,n=r.bam,e.abrupt("return",n.getHeaderText(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setup",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var r,n,a=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(t||{}).statusCallback,n=void 0===r?function(){}:r,this.setupP||(this.setupP=this.configure().then(function(){var e=Object(c.a)(i.a.mark((function e(r){var c,u,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=r.bam,n("Downloading index"),e.next=4,c.getHeader(t);case 4:return u=e.sent,s=[],o={},u.filter((function(e){return"SQ"===e.tag})).forEach((function(e,t){e.data.forEach((function(e){if("SN"===e.tag){var r=e.value;o[r]=t,s[t]=r}}))})),n(""),a.samHeader={idToName:s,nameToId:o},e.abrupt("return",a.samHeader);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){throw a.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var r,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup(t);case 2:return r=e.sent,n=r.idToName,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"seqFetch",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r,n){var a,c,u,s,o,f,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:if(a=e.sent,c=a.sequenceAdapter,u=c){e.next=7;break}return e.abrupt("return",void 0);case 7:if(t){e.next=9;break}return e.abrupt("return",void 0);case 9:return s=u.getFeatures({refName:t,start:r,end:n,assemblyName:""}),e.next=12,s.pipe(Object(l.a)()).toPromise();case 12:if(o=e.sent,f=[],o.sort((function(e,t){return e.get("start")-t.get("start")})).forEach((function(e){var t=e.get("start"),a=e.get("end"),i=Math.max(r-t,0),c=Math.min(n-t,a-t)-i,u=e.get("seq")||e.get("residues");f.push(u.substr(i,c))})),(d=f.join("")).length===n-r){e.next=18;break}throw new Error("sequence fetch failed: fetching ".concat(t,":").concat((r-1).toLocaleString(),"-").concat(n.toLocaleString()," returned ").concat(d.length.toLocaleString()," bases, but should have returned ").concat((n-r).toLocaleString()));case 18:return e.abrupt("return",d);case 19:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e,t){var r=this,a=e.refName,u=e.start,s=e.end,o=e.originalRefName,f=t||{},d=f.signal,h=f.statusCallback,p=void 0===h?function(){}:h;return Object(v.ObservableCreate)(function(){var e=Object(c.a)(i.a.mark((function e(c){var f,h,v,l,b,_,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.configure();case 2:return f=e.sent,h=f.bam,e.next=6,r.setup(t);case 6:return p("Downloading alignments"),e.next=9,h.getRecordsForRange(a,u,s,t);case 9:v=e.sent,Object(g.checkAbortSignal)(d),l=Object(n.a)(v),e.prev=12,l.s();case 14:if((b=l.n()).done){e.next=24;break}if(_=b.value,m=void 0,_.get("md")){e.next=21;break}return e.next=20,r.seqFetch(o||a,_.get("start"),_.get("end"));case 20:m=e.sent;case 21:c.next(new O(_,r,m));case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),l.e(e.t0);case 29:return e.prev=29,l.f(),e.finish(29);case 32:p(""),c.complete();case 34:case"end":return e.stop()}}),e,null,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}(),d)}},{key:"freeResources",value:function(){}},{key:"refIdToName",value:function(e){var t;return null===(t=this.samHeader)||void 0===t?void 0:t.idToName[e]}}]),r}(h.BaseFeatureDataAdapter)},2497:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return h}));var n=r(87),a=r.n(n),i=r(91),c=r(86),u=r(90),s=r(93),o=r(95),f=r(770),d=r(81),h=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"configure",value:function(){var e=Object(i.a)(a.a.mark((function e(){var t,r,n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.configured||(t=Object(d.readConfObject)(this.config,"htsgetBase"),r=Object(d.readConfObject)(this.config,"htsgetTrackId"),n=new f.HtsgetFile({baseUrl:t,trackId:r}),(i=Object(d.readConfObject)(this.config,"sequenceAdapter"))&&this.getSubAdapter&&(this.configured=this.getSubAdapter(i).then((function(e){var t=e.dataAdapter;return{bam:n,sequenceAdapter:t}}))),this.configured=Promise.resolve({bam:n})),e.abrupt("return",this.configured);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(r(1334).default)}}]);
//# sourceMappingURL=39.990ecf6b.chunk.js.map