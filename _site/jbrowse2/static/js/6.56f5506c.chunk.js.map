{"version":3,"sources":["../../src/bai.ts","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/array/is-array.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/symbol.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/array/from.js","../../../node_modules/core-js-pure/es/object/get-own-property-descriptor.js","../../../node_modules/core-js-pure/es/object/get-own-property-symbols.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/arrayWithHoles.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/is-iterable.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/unsupportedIterableToArray.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/array/from.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/nonIterableRest.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/object/set-prototype-of.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/typeof.js","../../src/virtualOffset.ts","../../src/chunk.ts","../../src/indexFile.ts","../../../node_modules/@gmod/bam/node_modules/abortable-promise-cache/dist/index.js","../../../node_modules/@gmod/bam/node_modules/abortable-promise-cache/dist/abortcontroller-ponyfill.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/instance/sort.js","../../src/csi.ts","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/interopRequireWildcard.js","../../src/bamFile.ts","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/wrapAsyncGenerator.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/symbol/async-iterator.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/AwaitValue.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/awaitAsyncGenerator.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/asyncGeneratorDelegate.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/asyncIterator.js","../../src/record.ts","../../src/sam.ts","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/instance/index-of.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/object/define-property.js","../../../node_modules/core-js-pure/stable/object/define-property.js","../../../node_modules/core-js-pure/stable/array/is-array.js","../../../node_modules/core-js-pure/features/get-iterator-method.js","../../../node_modules/core-js-pure/stable/symbol/index.js","../../../node_modules/core-js-pure/stable/array/from.js","../../../node_modules/core-js-pure/stable/object/define-properties.js","../../../node_modules/core-js-pure/es/object/define-properties.js","../../../node_modules/core-js-pure/modules/es.object.define-properties.js","../../../node_modules/core-js-pure/stable/object/get-own-property-descriptors.js","../../../node_modules/core-js-pure/es/object/get-own-property-descriptors.js","../../../node_modules/core-js-pure/modules/es.object.get-own-property-descriptors.js","../../../node_modules/core-js-pure/internals/own-keys.js","../../../node_modules/core-js-pure/stable/object/get-own-property-descriptor.js","../../../node_modules/core-js-pure/modules/es.object.get-own-property-descriptor.js","../../../node_modules/core-js-pure/stable/object/get-own-property-symbols.js","../../../node_modules/core-js-pure/stable/reflect/construct.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/array/is-array.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/iterableToArrayLimit.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/instance/slice.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/arrayLikeToArray.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/object/create.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/setPrototypeOf.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/object/get-prototype-of.js","../../../node_modules/@gmod/bam/node_modules/abortable-promise-cache/dist/AbortablePromiseCache.js","../../../node_modules/@gmod/bam/node_modules/abortable-promise-cache/dist/AggregateAbortController.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/number/min-safe-integer.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/number/max-safe-integer.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/set-timeout.js","../../../node_modules/core-js-pure/stable/set-timeout.js","../../../node_modules/core-js-pure/modules/web.timers.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/object/get-own-property-descriptor.js","../../../node_modules/core-js-pure/features/object/get-own-property-descriptor.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/weak-map.js","../../../node_modules/core-js-pure/features/weak-map/index.js","../../../node_modules/core-js-pure/es/weak-map/index.js","../../../node_modules/core-js-pure/modules/es.weak-map.js","../../../node_modules/core-js-pure/internals/collection-weak.js","../../../node_modules/core-js-pure/modules/esnext.weak-map.from.js","../../../node_modules/core-js-pure/modules/esnext.weak-map.of.js","../../../node_modules/core-js-pure/modules/esnext.weak-map.delete-all.js","../../../node_modules/core-js-pure/modules/esnext.weak-map.upsert.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/object/assign.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/instance/reduce.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/instance/bind.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/AsyncGenerator.js","../../../node_modules/core-js-pure/features/symbol/async-iterator.js","../../../node_modules/core-js-pure/es/symbol/async-iterator.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/instance/flags.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/parse-int.js","../../src/constants.ts","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/toArray.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/iterableToArray.js","../../src/htsget.ts","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/objectWithoutProperties.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/object/get-own-property-symbols.js","../../../node_modules/core-js-pure/features/object/get-own-property-symbols.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/objectWithoutPropertiesLoose.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/object/keys.js","../../../node_modules/core-js-pure/features/object/keys.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/instance/starts-with.js","../../../node_modules/core-js-pure/stable/instance/starts-with.js","../../../node_modules/core-js-pure/es/instance/starts-with.js","../../../node_modules/core-js-pure/es/string/virtual/starts-with.js","../../../node_modules/core-js-pure/modules/es.string.starts-with.js","../../../node_modules/cross-fetch/dist/browser-polyfill.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/interopRequireDefault.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/defineProperty.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/classCallCheck.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/createClass.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/instance/for-each.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/symbol.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/regenerator/index.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/asyncToGenerator.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/instance/concat.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/instance/filter.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/instance/map.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/instance/slice.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/object/keys.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/slicedToArray.js","../../src/index.ts","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/get-iterator.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/get-iterator-method.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/object/define-properties.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/reflect/construct.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/object/define-property.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/promise.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/inherits.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/possibleConstructorReturn.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js/symbol/iterator.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/assertThisInitialized.js","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/helpers/getPrototypeOf.js","../../src/util.ts","../../../node_modules/@gmod/bam/node_modules/@babel/runtime-corejs3/core-js-stable/promise.js"],"names":["roundDown","n","roundUp","BAI","bytes","offset","lineCount","longToNumber","Long","Array","refId","opts","this","parse","prom","index","ret","data","bai","maxBlockSize","filehandle","readFile","Error","binLimit","currOffset","i","refCount","abortBreakPoint","binCount","stats","binIndex","j","bin","parsePseudoBin","chunkCount","chunks","k","u","fromBytes","v","Chunk","linearCount","linearIndex","seqId","start","end","range","undefined","indexData","seqIdx","length","e","s","depths","totalSize","blockPosition","currentPos","score","d","beg","min","max","ba","overlappingBins","reg2bins","binChunks","c","nintv","lowest","minLin","Math","maxLin","vp","optimizeChunks","IndexFile","module","exports","require","Object","getOwnPropertyDescriptor","it","key","sham","path","getOwnPropertySymbols","_Array$isArray","arr","_Array$from","_sliceInstanceProperty","arrayLikeToArray","o","minLen","_context","prototype","toString","call","constructor","name","test","TypeError","_Symbol$iterator","_Symbol","_typeof","obj","bigendian","VirtualOffset","b","dataPosition","args","fetchedSize","minv","compareTo","maxv","_fetchedSize","renameRefSeq","virtualOffset","currentFdl","AbortablePromiseCache","cache","QuickLRU","maxSize","fill","signal","_parseCache","get","indices","__importDefault","mod","__esModule","defineProperty","value","AbortablePromiseCache_1","default","cjs_ponyfill_1","getGlobal","self","window","global","AbortController","AbortSignal","rshift","num","CSI","auxLength","0","1","2","ref","String","nameSectionLength","_parseNameBytes","namesBytes","currRefId","currNameStart","refIdToName","refNameToId","refName","csi","buffer","unzip","depth","parseAuxData","loffset","l","t","minShift","bins","_Object$getOwnPropertyDescriptor","_Object$defineProperty","_WeakMap","_getRequireWildcardCache","has","newObj","hasPropertyDescriptor","hasOwnProperty","desc","set","BamFile","bamFilehandle","bamPath","bamUrl","baiPath","baiFilehandle","baiUrl","csiPath","csiFilehandle","csiUrl","cacheSize","fetchSizeLimit","chunkSizeLimit","renameRefSeqs","LocalFile","RemoteFile","LRU","origOpts","makeOpts","bam","read","Buffer","res","bytesRead","uncba","headLen","_readRefSeqs","chrToIndex","indexToChr","parseHeaderText","getHeader","header","refSeqBytes","nRef","p","lName","lRef","console","chr","viewAsPairs","pairAcrossChr","maxInsertSize","records","streamRecordsForRange","chunk","chrId","size","a","featPromises","done","cpositions","dpositions","promise","recs","feature","checkAbortSignal","unmatedPairs","readIds","readNames","id","matePromises","mateBlocks","mateChunks","pos","item","ary","mateTotalSize","mateFeatPromises","feats","mateRecs","newMateFeats","featuresRet","newMates","result","abortSignal","bufsize","unzipChunkSlice","blockStart","sink","featsSinceLastTimeout","blockSize","blockEnd","BAMFeature","byteArray","fileOffset","crc32","timeout","seqName","hasRefSeq","indexCov","AsyncGenerator","fn","apply","arguments","wrapped","AwaitValue","_Promise","inner","awaitWrap","iter","waiting","pump","resolve","next","_getIteratorMethod","_Symbol$asyncIterator","iterable","method","SEQRET_DECODER","CIGAR_DECODER","split","BamRecord","field","_get","_parseTag","tags","_tagList","seen","lt","mq","lseq","qseq","isReverseComplemented","isMateReverseComplemented","nl","tagName","_tagOffset","lcTag","tag","type","cc","Btype","limit","cigop","cigar","op","Constants","numCigarOps","seqLen","lref","lop","seqBytes","len","buf","sb","_refID","s1","s2","o1","o2","tmp","readInt32LE","text","lines","line","fields","parsedFields","f","parent","getIteratorMethod","defineProperties","T","D","$","DESCRIPTORS","target","stat","forced","getOwnPropertyDescriptors","ownKeys","toIndexedObject","getOwnPropertyDescriptorModule","createProperty","object","descriptor","O","keys","getBuiltIn","getOwnPropertyNamesModule","getOwnPropertySymbolsModule","anObject","concat","fails","nativeGetOwnPropertyDescriptor","FAILS_ON_PRIMITIVES","_getIterator","_isIterable","_arr","_n","_d","_e","_s","_i","push","err","arr2","_Object$setPrototypeOf","_setPrototypeOf","__proto__","abortcontroller_ponyfill_1","AggregateAbortController_1","_a","delete","fillCallback","isAbortException","exception","code","message","evict","entry","_this","aborter","newEntry","settled","aborted","addSignal","addEventListener","then","catch","error","checkSinglePromise","checkForSingleAbort","assign","cacheEntry","cachedEntry","abort","clear","keyIter","deleteCount","NullSignal","AggregateAbortController","signals","Set","abortController","add","handleAborted","enumerable","configurable","setTimeout","userAgent","slice","wrap","scheduler","handler","boundArgs","Function","bind","setInterval","WeakMap","InternalWeakMap","redefineAll","InternalMetadataModule","collection","collectionWeak","isObject","enforceIternalState","enforce","NATIVE_WEAK_MAP","IS_IE11","ActiveXObject","isExtensible","wrapper","init","$WeakMap","getConstructor","REQUIRED","WeakMapPrototype","nativeDelete","nativeHas","nativeGet","nativeSet","state","frozen","getWeakData","anInstance","iterate","ArrayIterationModule","$has","InternalStateModule","setInternalState","internalStateGetterFor","getterFor","find","findIndex","uncaughtFrozenStore","store","UncaughtFrozenStore","entries","findUncaughtFrozen","splice","CONSTRUCTOR_NAME","IS_MAP","ADDER","C","that","getInternalState","define","from","of","IS_PURE","collectionDeleteAll","proto","real","deleteAll","upsert","gen","front","back","resume","arg","wrappedAwait","settle","reject","_invoke","request","WrappedWellKnownSymbolModule","BAM_FPAIRED","BAM_FPROPER_PAIR","BAM_FUNMAP","BAM_FMUNMAP","BAM_FREVERSE","BAM_FMREVERSE","BAM_FREAD1","BAM_FREAD2","BAM_FSECONDARY","BAM_FQCFAIL","BAM_FDUP","BAM_FSUPPLEMENTARY","arrayWithHoles","iterableToArray","unsupportedIterableToArray","nonIterableRest","url","headers","rest","fetch","elt","HtsgetFile","base","params","c2","baseUrl","trackId","ok","BAM_MAGIC","headerText","samHeader","idToName","nameToId","sqLines","sqLine","_indexOfInstanceProperty","_Object$getOwnPropertySymbols","objectWithoutPropertiesLoose","source","excluded","sourceSymbolKeys","propertyIsEnumerable","_Object$keys","sourceKeys","startsWith","StringPrototype","own","entryVirtual","toLength","notARegExp","requireObjectCoercible","correctIsRegExpLogic","nativeStartsWith","CORRECT_IS_REGEXP_LOGIC","writable","searchString","search","support","Symbol","Blob","viewClasses","isArrayBufferView","ArrayBuffer","isView","indexOf","normalizeName","toLowerCase","normalizeValue","iteratorFor","items","iterator","shift","Headers","map","forEach","append","isArray","getOwnPropertyNames","consumed","body","bodyUsed","Promise","fileReaderReady","reader","onload","onerror","readBlobAsArrayBuffer","blob","FileReader","readAsArrayBuffer","bufferClone","view","Uint8Array","byteLength","Body","_initBody","_bodyInit","_bodyText","isPrototypeOf","_bodyBlob","FormData","_bodyFormData","URLSearchParams","DataView","_bodyArrayBuffer","rejected","arrayBuffer","readAsText","readBlobAsText","chars","fromCharCode","join","readArrayBufferAsText","formData","decode","json","JSON","oldValue","callback","thisArg","values","methods","Request","input","options","credentials","mode","upcased","toUpperCase","normalizeMethod","referrer","form","trim","replace","decodeURIComponent","parseHeaders","rawHeaders","parts","Response","bodyInit","status","statusText","clone","response","redirectStatuses","redirect","RangeError","location","DOMException","stack","create","xhr","XMLHttpRequest","abortXhr","getAllResponseHeaders","responseURL","responseText","ontimeout","onabort","open","withCredentials","responseType","setRequestHeader","onreadystatechange","readyState","removeEventListener","send","polyfill","instance","Constructor","_defineProperties","props","protoProps","staticProps","asyncGeneratorStep","_next","_throw","info","iterableToArrayLimit","_Object$create","setPrototypeOf","subClass","superClass","assertThisInitialized","ReferenceError","_Object$getPrototypeOf","_getPrototypeOf","ms","long","mergedChunks","lastChunk","dif","c0","c1","canMergeBlocks","chunk1","chunk2"],"mappings":"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","file":"static/js/6.56f5506c.chunk.js","sourcesContent":["import Long from 'long'\nimport { fromBytes } from './virtualOffset'\nimport Chunk from './chunk'\n\nimport IndexFile from './indexFile'\nimport { longToNumber, abortBreakPoint, optimizeChunks, BaseOpts } from './util'\n\nconst BAI_MAGIC = 21578050 // BAI\\1\n\nfunction roundDown(n: number, multiple: number) {\n  return n - (n % multiple)\n}\nfunction roundUp(n: number, multiple: number) {\n  return n - (n % multiple) + multiple\n}\n\nexport default class BAI extends IndexFile {\n  parsePseudoBin(bytes: Buffer, offset: number) {\n    const lineCount = longToNumber(\n      Long.fromBytesLE(Array.prototype.slice.call(bytes, offset + 16, offset + 24), true),\n    )\n    return { lineCount }\n  }\n\n  async lineCount(refId: number, opts: BaseOpts = {}) {\n    const prom = await this.parse(opts)\n    const index = prom.indices[refId]\n    if (!index) {\n      return -1\n    }\n    const ret = index.stats || {}\n    return ret.lineCount === undefined ? -1 : ret.lineCount\n  }\n\n  // fetch and parse the index\n  async _parse(opts: BaseOpts = {}) {\n    const data: { [key: string]: any } = { bai: true, maxBlockSize: 1 << 16 }\n    const bytes = (await this.filehandle.readFile(opts)) as Buffer\n\n    // check BAI magic numbers\n    if (bytes.readUInt32LE(0) !== BAI_MAGIC) {\n      throw new Error('Not a BAI file')\n    }\n\n    data.refCount = bytes.readInt32LE(4)\n    const depth = 5\n    const binLimit = ((1 << ((depth + 1) * 3)) - 1) / 7\n\n    // read the indexes for each reference sequence\n    data.indices = new Array(data.refCount)\n    let currOffset = 8\n    for (let i = 0; i < data.refCount; i += 1) {\n      await abortBreakPoint(opts.signal)\n\n      // the binning index\n      const binCount = bytes.readInt32LE(currOffset)\n      let stats\n\n      currOffset += 4\n      const binIndex: { [key: number]: Chunk[] } = {}\n      for (let j = 0; j < binCount; j += 1) {\n        const bin = bytes.readUInt32LE(currOffset)\n        currOffset += 4\n        if (bin === binLimit + 1) {\n          currOffset += 4\n          stats = this.parsePseudoBin(bytes, currOffset)\n          currOffset += 32\n        } else if (bin > binLimit + 1) {\n          throw new Error('bai index contains too many bins, please use CSI')\n        } else {\n          const chunkCount = bytes.readInt32LE(currOffset)\n          currOffset += 4\n          const chunks = new Array(chunkCount)\n          for (let k = 0; k < chunkCount; k += 1) {\n            const u = fromBytes(bytes, currOffset)\n            const v = fromBytes(bytes, currOffset + 8)\n            currOffset += 16\n            this._findFirstData(data, u)\n            chunks[k] = new Chunk(u, v, bin)\n          }\n          binIndex[bin] = chunks\n        }\n      }\n\n      const linearCount = bytes.readInt32LE(currOffset)\n      currOffset += 4\n      // as we're going through the linear index, figure out\n      // the smallest virtual offset in the indexes, which\n      // tells us where the BAM header ends\n      const linearIndex = new Array(linearCount)\n      for (let k = 0; k < linearCount; k += 1) {\n        linearIndex[k] = fromBytes(bytes, currOffset)\n        currOffset += 8\n        this._findFirstData(data, linearIndex[k])\n      }\n\n      data.indices[i] = { binIndex, linearIndex, stats }\n    }\n\n    return data\n  }\n\n  async indexCov(\n    seqId: number,\n    start?: number,\n    end?: number,\n    opts: BaseOpts = {},\n  ): Promise<{ start: number; end: number; score: number }[]> {\n    const v = 16384\n    const range = start !== undefined\n    const indexData = await this.parse(opts)\n    const seqIdx = indexData.indices[seqId]\n    if (!seqIdx) {\n      return []\n    }\n    const { linearIndex = [], stats } = seqIdx\n    if (!linearIndex.length) {\n      return []\n    }\n    const e = end !== undefined ? roundUp(end, v) : (linearIndex.length - 1) * v\n    const s = start !== undefined ? roundDown(start, v) : 0\n    let depths\n    if (range) {\n      depths = new Array((e - s) / v)\n    } else {\n      depths = new Array(linearIndex.length - 1)\n    }\n    const totalSize = linearIndex[linearIndex.length - 1].blockPosition\n    if (e > (linearIndex.length - 1) * v) {\n      throw new Error('query outside of range of linear index')\n    }\n    let currentPos = linearIndex[s / v].blockPosition\n    for (let i = s / v, j = 0; i < e / v; i++, j++) {\n      depths[j] = {\n        score: linearIndex[i + 1].blockPosition - currentPos,\n        start: i * v,\n        end: i * v + v,\n      }\n      currentPos = linearIndex[i + 1].blockPosition\n    }\n    return depths.map(d => {\n      return { ...d, score: (d.score * stats.lineCount) / totalSize }\n    })\n  }\n\n  /**\n   * calculate the list of bins that may overlap with region [beg,end) (zero-based half-open)\n   * @returns {Array[number]}\n   */\n  reg2bins(beg: number, end: number) {\n    end -= 1\n    return [\n      [0, 0],\n      [1 + (beg >> 26), 1 + (end >> 26)],\n      [9 + (beg >> 23), 9 + (end >> 23)],\n      [73 + (beg >> 20), 73 + (end >> 20)],\n      [585 + (beg >> 17), 585 + (end >> 17)],\n      [4681 + (beg >> 14), 4681 + (end >> 14)],\n    ]\n  }\n\n  async blocksForRange(refId: number, min: number, max: number, opts: BaseOpts = {}) {\n    if (min < 0) {\n      min = 0\n    }\n\n    const indexData = await this.parse(opts)\n    if (!indexData) {\n      return []\n    }\n    const ba = indexData.indices[refId]\n    if (!ba) {\n      return []\n    }\n\n    const overlappingBins = this.reg2bins(min, max) // List of bin #s that overlap min, max\n    const chunks: Chunk[] = []\n\n    // Find chunks in overlapping bins.  Leaf bins (< 4681) are not pruned\n    for (const [start, end] of overlappingBins) {\n      for (let bin = start; bin <= end; bin++) {\n        if (ba.binIndex[bin]) {\n          const binChunks = ba.binIndex[bin]\n          for (let c = 0; c < binChunks.length; ++c) {\n            chunks.push(new Chunk(binChunks[c].minv, binChunks[c].maxv, bin))\n          }\n        }\n      }\n    }\n\n    // Use the linear index to find minimum file position of chunks that could contain alignments in the region\n    const nintv = ba.linearIndex.length\n    let lowest = null\n    const minLin = Math.min(min >> 14, nintv - 1)\n    const maxLin = Math.min(max >> 14, nintv - 1)\n    for (let i = minLin; i <= maxLin; ++i) {\n      const vp = ba.linearIndex[i]\n      if (vp) {\n        if (!lowest || vp.compareTo(lowest) < 0) {\n          lowest = vp\n        }\n      }\n    }\n\n    return optimizeChunks(chunks, lowest)\n  }\n}\n","module.exports = require(\"core-js-pure/stable/array/is-array\");","module.exports = require(\"core-js-pure/stable/symbol\");","module.exports = require(\"core-js-pure/stable/array/from\");","require('../../modules/es.object.get-own-property-descriptor');\nvar path = require('../../internals/path');\n\nvar Object = path.Object;\n\nvar getOwnPropertyDescriptor = module.exports = function getOwnPropertyDescriptor(it, key) {\n  return Object.getOwnPropertyDescriptor(it, key);\n};\n\nif (Object.getOwnPropertyDescriptor.sham) getOwnPropertyDescriptor.sham = true;\n","require('../../modules/es.symbol');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Object.getOwnPropertySymbols;\n","var _Array$isArray = require(\"../core-js/array/is-array\");\n\nfunction _arrayWithHoles(arr) {\n  if (_Array$isArray(arr)) return arr;\n}\n\nmodule.exports = _arrayWithHoles;","module.exports = require(\"core-js-pure/features/is-iterable\");","var _Array$from = require(\"../core-js/array/from\");\n\nvar _sliceInstanceProperty = require(\"../core-js/instance/slice\");\n\nvar arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  var _context;\n\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n\n  var n = _sliceInstanceProperty(_context = Object.prototype.toString.call(o)).call(_context, 8, -1);\n\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return _Array$from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\n\nmodule.exports = _unsupportedIterableToArray;","module.exports = require(\"core-js-pure/features/array/from\");","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableRest;","module.exports = require(\"core-js-pure/features/object/set-prototype-of\");","var _Symbol$iterator = require(\"../core-js/symbol/iterator\");\n\nvar _Symbol = require(\"../core-js/symbol\");\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof _Symbol === \"function\" && typeof _Symbol$iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof _Symbol === \"function\" && obj.constructor === _Symbol && obj !== _Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","export default class VirtualOffset {\n  public blockPosition: number\n  public dataPosition: number\n  constructor(blockPosition: number, dataPosition: number) {\n    this.blockPosition = blockPosition // < offset of the compressed data block\n    this.dataPosition = dataPosition // < offset into the uncompressed data\n  }\n\n  toString() {\n    return `${this.blockPosition}:${this.dataPosition}`\n  }\n\n  compareTo(b: VirtualOffset) {\n    return this.blockPosition - b.blockPosition || this.dataPosition - b.dataPosition\n  }\n\n  static min(...args: VirtualOffset[]) {\n    let min\n    let i = 0\n    for (; !min; i += 1) {\n      min = args[i]\n    }\n    for (; i < args.length; i += 1) {\n      if (min.compareTo(args[i]) > 0) {\n        min = args[i]\n      }\n    }\n    return min\n  }\n}\nexport function fromBytes(bytes: Buffer, offset = 0, bigendian = false) {\n  if (bigendian) {\n    throw new Error('big-endian virtual file offsets not implemented')\n  }\n\n  return new VirtualOffset(\n    bytes[offset + 7] * 0x10000000000 +\n      bytes[offset + 6] * 0x100000000 +\n      bytes[offset + 5] * 0x1000000 +\n      bytes[offset + 4] * 0x10000 +\n      bytes[offset + 3] * 0x100 +\n      bytes[offset + 2],\n    (bytes[offset + 1] << 8) | bytes[offset],\n  )\n}\n","import VirtualOffset from './virtualOffset'\n\n// little class representing a chunk in the index\nexport default class Chunk {\n  public minv: VirtualOffset\n  public maxv: VirtualOffset\n  public bin: number\n  public _fetchedSize?: number\n\n  /**\n   * @param {VirtualOffset} minv\n   * @param {VirtualOffset} maxv\n   * @param {number} bin\n   * @param {number} [fetchedSize]\n   */\n  constructor(minv: VirtualOffset, maxv: VirtualOffset, bin: number, fetchedSize = undefined) {\n    this.minv = minv\n    this.maxv = maxv\n    this.bin = bin\n    this._fetchedSize = fetchedSize\n  }\n\n  toUniqueString() {\n    return `${this.minv}..${this.maxv} (bin ${this.bin}, fetchedSize ${this.fetchedSize()})`\n  }\n\n  toString() {\n    return this.toUniqueString()\n  }\n\n  compareTo(b: Chunk) {\n    return this.minv.compareTo(b.minv) || this.maxv.compareTo(b.maxv) || this.bin - b.bin\n  }\n\n  fetchedSize() {\n    if (this._fetchedSize !== undefined) {\n      return this._fetchedSize\n    }\n    return this.maxv.blockPosition + (1 << 16) - this.minv.blockPosition\n  }\n}\n","import AbortablePromiseCache from 'abortable-promise-cache'\nimport QuickLRU from 'quick-lru'\nimport { GenericFilehandle } from 'generic-filehandle'\nimport VirtualOffset from './virtualOffset'\nimport Chunk from './chunk'\nimport { BaseOpts } from './util'\n\nexport default abstract class IndexFile {\n  public filehandle: GenericFilehandle\n  public renameRefSeq: Function\n  private _parseCache: any\n\n  /**\n   * @param {filehandle} filehandle\n   * @param {function} [renameRefSeqs]\n   */\n  constructor({\n    filehandle,\n    renameRefSeq = (n: string) => n,\n  }: {\n    filehandle: GenericFilehandle\n    renameRefSeq?: (a: string) => string\n  }) {\n    this.filehandle = filehandle\n    this.renameRefSeq = renameRefSeq\n  }\n  public abstract async lineCount(refId: number): Promise<number>\n  protected abstract async _parse(opts?: BaseOpts): Promise<any>\n  public abstract async indexCov(\n    refId: number,\n    start?: number,\n    end?: number,\n  ): Promise<{ start: number; end: number; score: number }[]>\n  public abstract async blocksForRange(\n    chrId: number,\n    start: number,\n    end: number,\n    opts: BaseOpts,\n  ): Promise<Chunk[]>\n\n  _findFirstData(data: any, virtualOffset: VirtualOffset) {\n    const currentFdl = data.firstDataLine\n    if (currentFdl) {\n      data.firstDataLine = currentFdl.compareTo(virtualOffset) > 0 ? virtualOffset : currentFdl\n    } else {\n      data.firstDataLine = virtualOffset\n    }\n  }\n\n  async parse(opts: BaseOpts = {}) {\n    if (!this._parseCache) {\n      this._parseCache = new AbortablePromiseCache({\n        cache: new QuickLRU({ maxSize: 1 }),\n        fill: (opts: BaseOpts, signal?: AbortSignal) => {\n          return this._parse({ ...opts, signal })\n        },\n      })\n    }\n    return this._parseCache.get('index', opts, opts.signal)\n  }\n\n  async hasRefSeq(seqId: number, opts: BaseOpts = {}) {\n    return !!((await this.parse(opts)).indices[seqId] || {}).binIndex\n  }\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar AbortablePromiseCache_1 = __importDefault(require(\"./AbortablePromiseCache\"));\nexports.default = AbortablePromiseCache_1.default;\n","\"use strict\";\n/* eslint-disable */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cjs_ponyfill_1 = require(\"abortcontroller-polyfill/dist/cjs-ponyfill\");\nvar getGlobal = function () {\n    // the only reliable means to get the global object is\n    // `Function('return this')()`\n    // However, this causes CSP violations in Chrome apps.\n    if (typeof self !== 'undefined') {\n        return self;\n    }\n    if (typeof window !== 'undefined') {\n        return window;\n    }\n    if (typeof global !== 'undefined') {\n        return global;\n    }\n    throw new Error('unable to locate global object');\n};\n//@ts-ignore\nvar AbortController = typeof getGlobal().AbortController === 'undefined' ? cjs_ponyfill_1.AbortController : getGlobal().AbortController;\nexports.AbortController = AbortController;\n//@ts-ignore\nvar AbortSignal = typeof getGlobal().AbortController === 'undefined' ? cjs_ponyfill_1.AbortSignal : getGlobal().AbortSignal;\nexports.AbortSignal = AbortSignal;\n","module.exports = require(\"core-js-pure/stable/instance/sort\");","import Long from 'long'\nimport { unzip } from '@gmod/bgzf-filehandle'\nimport VirtualOffset, { fromBytes } from './virtualOffset'\nimport Chunk from './chunk'\nimport { longToNumber, abortBreakPoint, optimizeChunks, BaseOpts } from './util'\n\nimport IndexFile from './indexFile'\n\nconst CSI1_MAGIC = 21582659 // CSI\\1\nconst CSI2_MAGIC = 38359875 // CSI\\2\n\nfunction lshift(num: number, bits: number) {\n  return num * 2 ** bits\n}\nfunction rshift(num: number, bits: number) {\n  return Math.floor(num / 2 ** bits)\n}\n\nexport default class CSI extends IndexFile {\n  private maxBinNumber: number\n  private depth: number\n  private minShift: number\n  constructor(args: any) {\n    super(args)\n    this.maxBinNumber = 0\n    this.depth = 0\n    this.minShift = 0\n  }\n  async lineCount(refId: number): Promise<number> {\n    const indexData = await this.parse()\n    if (!indexData) {\n      return -1\n    }\n    const idx = indexData.indices[refId]\n    if (!idx) {\n      return -1\n    }\n    const { stats } = indexData.indices[refId]\n    if (stats) {\n      return stats.lineCount\n    }\n    return -1\n  }\n\n  async indexCov() {\n    return []\n  }\n\n  parseAuxData(bytes: Buffer, offset: number, auxLength: number) {\n    if (auxLength < 30) {\n      return {}\n    }\n\n    const data: { [key: string]: any } = {}\n    data.formatFlags = bytes.readInt32LE(offset)\n    data.coordinateType = data.formatFlags & 0x10000 ? 'zero-based-half-open' : '1-based-closed'\n    data.format = ({ 0: 'generic', 1: 'SAM', 2: 'VCF' } as { [key: number]: string })[\n      data.formatFlags & 0xf\n    ]\n    if (!data.format) {\n      throw new Error(`invalid Tabix preset format flags ${data.formatFlags}`)\n    }\n    data.columnNumbers = {\n      ref: bytes.readInt32LE(offset + 4),\n      start: bytes.readInt32LE(offset + 8),\n      end: bytes.readInt32LE(offset + 12),\n    }\n    data.metaValue = bytes.readInt32LE(offset + 16)\n    data.metaChar = data.metaValue ? String.fromCharCode(data.metaValue) : ''\n    data.skipLines = bytes.readInt32LE(offset + 20)\n    const nameSectionLength = bytes.readInt32LE(offset + 24)\n\n    Object.assign(\n      data,\n      this._parseNameBytes(bytes.slice(offset + 28, offset + 28 + nameSectionLength)),\n    )\n    return data\n  }\n\n  _parseNameBytes(namesBytes: Buffer) {\n    let currRefId = 0\n    let currNameStart = 0\n    const refIdToName = []\n    const refNameToId: { [key: string]: number } = {}\n    for (let i = 0; i < namesBytes.length; i += 1) {\n      if (!namesBytes[i]) {\n        if (currNameStart < i) {\n          let refName = namesBytes.toString('utf8', currNameStart, i)\n          refName = this.renameRefSeq(refName)\n          refIdToName[currRefId] = refName\n          refNameToId[refName] = currRefId\n        }\n        currNameStart = i + 1\n        currRefId += 1\n      }\n    }\n    return { refNameToId, refIdToName }\n  }\n\n  // fetch and parse the index\n  async _parse(opts: { signal?: AbortSignal }) {\n    const data: { [key: string]: any } = { csi: true, maxBlockSize: 1 << 16 }\n    const buffer = (await this.filehandle.readFile(opts)) as Buffer\n    const bytes = await unzip(buffer)\n\n    // check TBI magic numbers\n    if (bytes.readUInt32LE(0) === CSI1_MAGIC) {\n      data.csiVersion = 1\n    } else if (bytes.readUInt32LE(0) === CSI2_MAGIC) {\n      data.csiVersion = 2\n    } else {\n      throw new Error('Not a CSI file')\n      // TODO: do we need to support big-endian CSI files?\n    }\n\n    this.minShift = bytes.readInt32LE(4)\n    this.depth = bytes.readInt32LE(8)\n    this.maxBinNumber = ((1 << ((this.depth + 1) * 3)) - 1) / 7\n    const auxLength = bytes.readInt32LE(12)\n    if (auxLength) {\n      Object.assign(data, this.parseAuxData(bytes, 16, auxLength))\n    }\n    data.refCount = bytes.readInt32LE(16 + auxLength)\n\n    // read the indexes for each reference sequence\n    data.indices = new Array(data.refCount)\n    let currOffset = 16 + auxLength + 4\n    for (let i = 0; i < data.refCount; i += 1) {\n      await abortBreakPoint(opts.signal)\n      // the binning index\n      const binCount = bytes.readInt32LE(currOffset)\n      currOffset += 4\n      const binIndex: { [key: string]: Chunk[] } = {}\n      let stats // < provided by parsing a pseudo-bin, if present\n      for (let j = 0; j < binCount; j += 1) {\n        const bin = bytes.readUInt32LE(currOffset)\n        if (bin > this.maxBinNumber) {\n          // this is a fake bin that actually has stats information\n          // about the reference sequence in it\n          stats = this.parsePseudoBin(bytes, currOffset + 4)\n          currOffset += 4 + 8 + 4 + 16 + 16\n        } else {\n          const loffset = fromBytes(bytes, currOffset + 4)\n          this._findFirstData(data, loffset)\n          const chunkCount = bytes.readInt32LE(currOffset + 12)\n          currOffset += 16\n          const chunks = new Array(chunkCount)\n          for (let k = 0; k < chunkCount; k += 1) {\n            const u = fromBytes(bytes, currOffset)\n            const v = fromBytes(bytes, currOffset + 8)\n            currOffset += 16\n            // this._findFirstData(data, u)\n            chunks[k] = new Chunk(u, v, bin)\n          }\n          binIndex[bin] = chunks\n        }\n      }\n\n      data.indices[i] = { binIndex, stats }\n    }\n\n    return data\n  }\n\n  parsePseudoBin(bytes: Buffer, offset: number) {\n    // const one = Long.fromBytesLE(bytes.slice(offset + 4, offset + 12), true)\n    // const two = Long.fromBytesLE(bytes.slice(offset + 12, offset + 20), true)\n    // const three = longToNumber(\n    //   Long.fromBytesLE(bytes.slice(offset + 20, offset + 28), true),\n    // )\n    const lineCount = longToNumber(\n      Long.fromBytesLE(Array.prototype.slice.call(bytes, offset + 28, offset + 36), true),\n    )\n    return { lineCount }\n  }\n\n  async blocksForRange(refId: number, min: number, max: number, opts: BaseOpts = {}) {\n    if (min < 0) {\n      min = 0\n    }\n\n    const indexData = await this.parse(opts)\n    if (!indexData) {\n      return []\n    }\n    const ba = indexData.indices[refId]\n    if (!ba) {\n      return []\n    }\n\n    const overlappingBins = this.reg2bins(min, max) // List of bin #s that overlap min, max\n    const chunks: Chunk[] = []\n\n    // Find chunks in overlapping bins.  Leaf bins (< 4681) are not pruned\n    for (const [start, end] of overlappingBins) {\n      for (let bin = start; bin <= end; bin++) {\n        if (ba.binIndex[bin]) {\n          const binChunks = ba.binIndex[bin]\n          for (let c = 0; c < binChunks.length; ++c) {\n            chunks.push(new Chunk(binChunks[c].minv, binChunks[c].maxv, bin))\n          }\n        }\n      }\n    }\n\n    return optimizeChunks(chunks, new VirtualOffset(0, 0))\n  }\n\n  /**\n   * calculate the list of bins that may overlap with region [beg,end) (zero-based half-open)\n   * @returns {Array[number]}\n   */\n  reg2bins(beg: number, end: number) {\n    beg -= 1 // < convert to 1-based closed\n    if (beg < 1) {\n      beg = 1\n    }\n    if (end > 2 ** 50) {\n      end = 2 ** 34\n    } // 17 GiB ought to be enough for anybody\n    end -= 1\n    let l = 0\n    let t = 0\n    let s = this.minShift + this.depth * 3\n    const bins = []\n    for (; l <= this.depth; s -= 3, t += lshift(1, l * 3), l += 1) {\n      const b = t + rshift(beg, s)\n      const e = t + rshift(end, s)\n      if (e - b + bins.length > this.maxBinNumber) {\n        throw new Error(\n          `query ${beg}-${end} is too large for current binning scheme (shift ${this.minShift}, depth ${this.depth}), try a smaller query or a coarser index binning scheme`,\n        )\n      }\n      bins.push([b, e])\n    }\n    return bins\n  }\n}\n","var _Object$getOwnPropertyDescriptor = require(\"../core-js/object/get-own-property-descriptor\");\n\nvar _Object$defineProperty = require(\"../core-js/object/define-property\");\n\nvar _typeof = require(\"../helpers/typeof\");\n\nvar _WeakMap = require(\"../core-js/weak-map\");\n\nfunction _getRequireWildcardCache() {\n  if (typeof _WeakMap !== \"function\") return null;\n  var cache = new _WeakMap();\n\n  _getRequireWildcardCache = function _getRequireWildcardCache() {\n    return cache;\n  };\n\n  return cache;\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") {\n    return {\n      \"default\": obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache();\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = _Object$defineProperty && _Object$getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? _Object$getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        _Object$defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj[\"default\"] = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nmodule.exports = _interopRequireWildcard;","import AbortablePromiseCache from 'abortable-promise-cache'\nimport BAI from './bai'\nimport CSI from './csi'\nimport Chunk from './chunk'\nimport crc32 from 'buffer-crc32'\n\nimport { unzip, unzipChunkSlice } from '@gmod/bgzf-filehandle'\n\nimport entries from 'object.entries-ponyfill'\nimport LRU from 'quick-lru'\nimport { LocalFile, RemoteFile, GenericFilehandle } from 'generic-filehandle'\nimport BAMFeature from './record'\nimport IndexFile from './indexFile'\nimport { parseHeaderText } from './sam'\nimport { abortBreakPoint, checkAbortSignal, timeout, makeOpts, BamOpts, BaseOpts } from './util'\n\nexport const BAM_MAGIC = 21840194\n\nconst blockLen = 1 << 16\n\nexport default class BamFile {\n  private renameRefSeq: (a: string) => string\n  private bam: GenericFilehandle\n  private index: IndexFile\n  private chunkSizeLimit: number\n  private fetchSizeLimit: number\n  private header: any\n  protected featureCache: any\n  protected chrToIndex: any\n  protected indexToChr: any\n\n  /**\n   * @param {object} args\n   * @param {string} [args.bamPath]\n   * @param {FileHandle} [args.bamFilehandle]\n   * @param {string} [args.baiPath]\n   * @param {FileHandle} [args.baiFilehandle]\n   */\n  constructor({\n    bamFilehandle,\n    bamPath,\n    bamUrl,\n    baiPath,\n    baiFilehandle,\n    baiUrl,\n    csiPath,\n    csiFilehandle,\n    csiUrl,\n    cacheSize,\n    fetchSizeLimit,\n    chunkSizeLimit,\n    renameRefSeqs = n => n,\n  }: {\n    bamFilehandle?: GenericFilehandle\n    bamPath?: string\n    bamUrl?: string\n    baiPath?: string\n    baiFilehandle?: GenericFilehandle\n    baiUrl?: string\n    csiPath?: string\n    csiFilehandle?: GenericFilehandle\n    csiUrl?: string\n    cacheSize?: number\n    fetchSizeLimit?: number\n    chunkSizeLimit?: number\n    renameRefSeqs?: (a: string) => string\n  }) {\n    this.renameRefSeq = renameRefSeqs\n\n    if (bamFilehandle) {\n      this.bam = bamFilehandle\n    } else if (bamPath) {\n      this.bam = new LocalFile(bamPath)\n    } else if (bamUrl) {\n      this.bam = new RemoteFile(bamUrl)\n    } else {\n      throw new Error('unable to initialize bam')\n    }\n    if (csiFilehandle) {\n      this.index = new CSI({ filehandle: csiFilehandle })\n    } else if (csiPath) {\n      this.index = new CSI({ filehandle: new LocalFile(csiPath) })\n    } else if (csiUrl) {\n      this.index = new CSI({ filehandle: new RemoteFile(csiUrl) })\n    } else if (baiFilehandle) {\n      this.index = new BAI({ filehandle: baiFilehandle })\n    } else if (baiPath) {\n      this.index = new BAI({ filehandle: new LocalFile(baiPath) })\n    } else if (baiUrl) {\n      this.index = new BAI({ filehandle: new RemoteFile(baiUrl) })\n    } else if (bamPath) {\n      this.index = new BAI({ filehandle: new LocalFile(`${bamPath}.bai`) })\n    } else if (bamUrl) {\n      this.index = new BAI({ filehandle: new RemoteFile(`${bamUrl}.bai`) })\n    } else {\n      throw new Error('unable to infer index format')\n    }\n    this.featureCache = new AbortablePromiseCache({\n      cache: new LRU({\n        maxSize: cacheSize !== undefined ? cacheSize : 50,\n      }),\n      fill: this._readChunk.bind(this),\n    })\n    this.fetchSizeLimit = fetchSizeLimit || 500000000 // 500MB\n    this.chunkSizeLimit = chunkSizeLimit || 300000000 // 300MB\n  }\n\n  async getHeader(origOpts: AbortSignal | BaseOpts = {}) {\n    const opts = makeOpts(origOpts)\n    const indexData = await this.index.parse(opts)\n    const ret = indexData.firstDataLine ? indexData.firstDataLine.blockPosition + 65535 : undefined\n    let buffer\n    if (ret) {\n      const res = await this.bam.read(Buffer.alloc(ret + blockLen), 0, ret + blockLen, 0, opts)\n\n      const { bytesRead } = res\n      ;({ buffer } = res)\n      if (!bytesRead) {\n        throw new Error('Error reading header')\n      }\n      if (bytesRead < ret) {\n        buffer = buffer.slice(0, bytesRead)\n      } else {\n        buffer = buffer.slice(0, ret)\n      }\n    } else {\n      buffer = (await this.bam.readFile(opts)) as Buffer\n    }\n\n    const uncba = await unzip(buffer)\n\n    if (uncba.readInt32LE(0) !== BAM_MAGIC) {\n      throw new Error('Not a BAM file')\n    }\n    const headLen = uncba.readInt32LE(4)\n\n    this.header = uncba.toString('utf8', 8, 8 + headLen)\n    const { chrToIndex, indexToChr } = await this._readRefSeqs(headLen + 8, 65535, opts)\n    this.chrToIndex = chrToIndex\n    this.indexToChr = indexToChr\n\n    return parseHeaderText(this.header)\n  }\n\n  async getHeaderText(opts: BaseOpts = {}) {\n    await this.getHeader(opts)\n    return this.header\n  }\n\n  // the full length of the refseq block is not given in advance so this grabs a chunk and\n  // doubles it if all refseqs haven't been processed\n  async _readRefSeqs(\n    start: number,\n    refSeqBytes: number,\n    opts: BaseOpts = {},\n  ): Promise<{\n    chrToIndex: { [key: string]: number }\n    indexToChr: { refName: string; length: number }[]\n  }> {\n    if (start > refSeqBytes) {\n      return this._readRefSeqs(start, refSeqBytes * 2, opts)\n    }\n    const res = await this.bam.read(Buffer.alloc(refSeqBytes + blockLen), 0, refSeqBytes, 0, opts)\n    const { bytesRead } = res\n    let { buffer } = res\n    if (!bytesRead) {\n      throw new Error('Error reading refseqs from header')\n    }\n    if (bytesRead < refSeqBytes) {\n      buffer = buffer.slice(0, bytesRead)\n    } else {\n      buffer = buffer.slice(0, refSeqBytes)\n    }\n    const uncba = await unzip(buffer)\n    const nRef = uncba.readInt32LE(start)\n    let p = start + 4\n    const chrToIndex: { [key: string]: number } = {}\n    const indexToChr: { refName: string; length: number }[] = []\n    for (let i = 0; i < nRef; i += 1) {\n      await abortBreakPoint(opts.signal)\n      const lName = uncba.readInt32LE(p)\n      let refName = uncba.toString('utf8', p + 4, p + 4 + lName - 1)\n      refName = this.renameRefSeq(refName)\n      const lRef = uncba.readInt32LE(p + lName + 4)\n\n      chrToIndex[refName] = i\n      indexToChr.push({ refName, length: lRef })\n\n      p = p + 8 + lName\n      if (p > uncba.length) {\n        console.warn(`BAM header is very big.  Re-fetching ${refSeqBytes} bytes.`)\n        return this._readRefSeqs(start, refSeqBytes * 2, opts)\n      }\n    }\n    return { chrToIndex, indexToChr }\n  }\n\n  async getRecordsForRange(\n    chr: string,\n    min: number,\n    max: number,\n    opts: BamOpts = { viewAsPairs: false, pairAcrossChr: false, maxInsertSize: 200000 },\n  ) {\n    let records: BAMFeature[] = []\n    for await (const chunk of this.streamRecordsForRange(chr, min, max, opts)) {\n      records = records.concat(chunk)\n    }\n    return records\n  }\n\n  async *streamRecordsForRange(\n    chr: string,\n    min: number,\n    max: number,\n    opts: BamOpts = { viewAsPairs: false, pairAcrossChr: false, maxInsertSize: 200000 },\n  ) {\n    // todo regularize refseq names\n    opts.viewAsPairs = opts.viewAsPairs || false\n    opts.pairAcrossChr = opts.pairAcrossChr || false\n    opts.maxInsertSize = opts.maxInsertSize !== undefined ? opts.maxInsertSize : 200000\n    const chrId = this.chrToIndex && this.chrToIndex[chr]\n    let chunks: Chunk[]\n    if (!(chrId >= 0)) {\n      chunks = []\n    } else {\n      chunks = await this.index.blocksForRange(chrId, min - 1, max, opts)\n\n      if (!chunks) {\n        throw new Error('Error in index fetch')\n      }\n    }\n\n    for (let i = 0; i < chunks.length; i += 1) {\n      await abortBreakPoint(opts.signal)\n      const size = chunks[i].fetchedSize()\n      if (size > this.chunkSizeLimit) {\n        throw new Error(\n          `Too many BAM features. BAM chunk size ${size} bytes exceeds chunkSizeLimit of ${this.chunkSizeLimit}`,\n        )\n      }\n    }\n\n    const totalSize = chunks\n      .map((s: Chunk) => s.fetchedSize())\n      .reduce((a: number, b: number) => a + b, 0)\n    if (totalSize > this.fetchSizeLimit) {\n      throw new Error(\n        `data size of ${totalSize.toLocaleString()} bytes exceeded fetch size limit of ${this.fetchSizeLimit.toLocaleString()} bytes`,\n      )\n    }\n    yield* this._fetchChunkFeatures(chunks, chrId, min, max, opts)\n  }\n\n  async *_fetchChunkFeatures(\n    chunks: Chunk[],\n    chrId: number,\n    min: number,\n    max: number,\n    opts: BamOpts,\n  ) {\n    const featPromises = []\n    let done = false\n\n    for (let i = 0; i < chunks.length; i++) {\n      const c = chunks[i]\n      const { data, cpositions, dpositions, chunk } = await this.featureCache.get(\n        c.toString(),\n        { chunk: c, opts },\n        opts.signal,\n      )\n      const promise = this.readBamFeatures(data, cpositions, dpositions, chunk).then(records => {\n        const recs = []\n        for (let i = 0; i < records.length; i += 1) {\n          const feature = records[i]\n          if (feature.seq_id() === chrId) {\n            if (feature.get('start') >= max) {\n              // past end of range, can stop iterating\n              done = true\n              break\n            } else if (feature.get('end') >= min) {\n              // must be in range\n              recs.push(feature)\n            }\n          }\n        }\n        return recs\n      })\n      featPromises.push(promise)\n      await promise\n      if (done) {\n        break\n      }\n    }\n\n    checkAbortSignal(opts.signal)\n\n    for (let i = 0; i < featPromises.length; i++) {\n      yield featPromises[i]\n    }\n    checkAbortSignal(opts.signal)\n    if (opts.viewAsPairs) {\n      yield this.fetchPairs(chrId, featPromises, opts)\n    }\n  }\n\n  async fetchPairs(chrId: number, featPromises: Promise<BAMFeature[]>[], opts: BamOpts) {\n    const unmatedPairs: { [key: string]: boolean } = {}\n    const readIds: { [key: string]: number } = {}\n    await Promise.all(\n      featPromises.map(async f => {\n        const ret = await f\n        const readNames: { [key: string]: number } = {}\n        for (let i = 0; i < ret.length; i++) {\n          const name = ret[i].name()\n          const id = ret[i].id()\n          if (!readNames[name]) {\n            readNames[name] = 0\n          }\n          readNames[name]++\n          readIds[id] = 1\n        }\n        entries(readNames).forEach(([k, v]: [string, number]) => {\n          if (v === 1) {\n            unmatedPairs[k] = true\n          }\n        })\n      }),\n    )\n\n    const matePromises: Promise<Chunk[]>[] = []\n    await Promise.all(\n      featPromises.map(async f => {\n        const ret = await f\n        for (let i = 0; i < ret.length; i++) {\n          const name = ret[i].name()\n          if (\n            unmatedPairs[name] &&\n            (opts.pairAcrossChr ||\n              (ret[i]._next_refid() === chrId &&\n                Math.abs(ret[i].get('start') - ret[i]._next_pos()) <\n                  (opts.maxInsertSize || 200000)))\n          ) {\n            matePromises.push(\n              this.index.blocksForRange(\n                ret[i]._next_refid(),\n                ret[i]._next_pos(),\n                ret[i]._next_pos() + 1,\n                opts,\n              ),\n            )\n          }\n        }\n      }),\n    )\n\n    const mateBlocks = await Promise.all(matePromises)\n    let mateChunks: Chunk[] = []\n    for (let i = 0; i < mateBlocks.length; i++) {\n      mateChunks = mateChunks.concat(mateBlocks[i])\n    }\n    // filter out duplicate chunks (the blocks are lists of chunks, blocks are concatenated, then filter dup chunks)\n    mateChunks = mateChunks\n      .sort()\n      .filter((item, pos, ary) => !pos || item.toString() !== ary[pos - 1].toString())\n\n    const mateTotalSize = mateChunks.map(s => s.fetchedSize()).reduce((a, b) => a + b, 0)\n    if (mateTotalSize > this.fetchSizeLimit) {\n      throw new Error(\n        `data size of ${mateTotalSize.toLocaleString()} bytes exceeded fetch size limit of ${this.fetchSizeLimit.toLocaleString()} bytes`,\n      )\n    }\n    const mateFeatPromises = mateChunks.map(async c => {\n      const { data, cpositions, dpositions, chunk } = await this.featureCache.get(\n        c.toString(),\n        { chunk: c, opts },\n        opts.signal,\n      )\n      const feats = await this.readBamFeatures(data, cpositions, dpositions, chunk)\n      const mateRecs = []\n      for (let i = 0; i < feats.length; i += 1) {\n        const feature = feats[i]\n        if (unmatedPairs[feature.get('name')] && !readIds[feature.id()]) {\n          mateRecs.push(feature)\n        }\n      }\n      return mateRecs\n    })\n    const newMateFeats = await Promise.all(mateFeatPromises)\n    let featuresRet: BAMFeature[] = []\n    if (newMateFeats.length) {\n      const newMates = newMateFeats.reduce((result, current) => result.concat(current))\n      featuresRet = featuresRet.concat(newMates)\n    }\n    return featuresRet\n  }\n\n  async _readChunk({ chunk, opts }: { chunk: unknown; opts: BaseOpts }, abortSignal?: AbortSignal) {\n    const c = chunk as Chunk\n    const bufsize = c.fetchedSize()\n    const res = await this.bam.read(Buffer.alloc(bufsize), 0, bufsize, c.minv.blockPosition, opts)\n    const { bytesRead } = res\n    let { buffer } = res\n    checkAbortSignal(abortSignal)\n    if (!bytesRead) {\n      return []\n    }\n    if (bytesRead < bufsize) {\n      buffer = buffer.slice(0, bytesRead)\n    } else {\n      buffer = buffer.slice(0, bufsize)\n    }\n\n    const { buffer: data, cpositions, dpositions } = await unzipChunkSlice(buffer, chunk)\n    checkAbortSignal(abortSignal)\n    return { data, cpositions, dpositions, chunk }\n  }\n\n  async readBamFeatures(ba: Buffer, cpositions: number[], dpositions: number[], chunk: Chunk) {\n    let blockStart = 0\n    const sink = []\n    let pos = 0\n    let featsSinceLastTimeout = 0\n\n    while (blockStart + 4 < ba.length) {\n      const blockSize = ba.readInt32LE(blockStart)\n      const blockEnd = blockStart + 4 + blockSize - 1\n\n      // increment position to the current decompressed status\n      if (dpositions) {\n        while (blockStart + chunk.minv.dataPosition >= dpositions[pos++]) {}\n        pos--\n      }\n\n      // only try to read the feature if we have all the bytes for it\n      if (blockEnd < ba.length) {\n        const feature = new BAMFeature({\n          bytes: {\n            byteArray: ba,\n            start: blockStart,\n            end: blockEnd,\n          },\n          // the below results in an automatically calculated file-offset based ID\n          // if the info for that is available, otherwise crc32 of the features\n          //\n          // cpositions[pos] refers to actual file offset of a bgzip block boundaries\n          //\n          // we multiply by (1 <<8) in order to make sure each block has a \"unique\"\n          // address space so that data in that block could never overlap\n          //\n          // then the blockStart-dpositions is an uncompressed file offset from\n          // that bgzip block boundary, and since the cpositions are multiplied by\n          // (1 << 8) these uncompressed offsets get a unique space\n          //\n          // this has an extra chunk.minv.dataPosition added on because it blockStart\n          // starts at 0 instead of chunk.minv.dataPosition\n          //\n          // the +1 is just to avoid any possible uniqueId 0 but this does not realistically happen\n          fileOffset: cpositions\n            ? cpositions[pos] * (1 << 8) +\n              (blockStart - dpositions[pos]) +\n              chunk.minv.dataPosition +\n              1\n            : crc32.signed(ba.slice(blockStart, blockEnd)),\n        })\n\n        sink.push(feature)\n        featsSinceLastTimeout++\n        if (featsSinceLastTimeout > 500) {\n          await timeout(1)\n          featsSinceLastTimeout = 0\n        }\n      }\n\n      blockStart = blockEnd + 1\n    }\n    return sink\n  }\n\n  async hasRefSeq(seqName: string) {\n    const refId = this.chrToIndex && this.chrToIndex[seqName]\n    return this.index.hasRefSeq(refId)\n  }\n\n  async lineCount(seqName: string) {\n    const refId = this.chrToIndex && this.chrToIndex[seqName]\n    return this.index.lineCount(refId)\n  }\n\n  async indexCov(seqName: string, start?: number, end?: number) {\n    await this.index.parse()\n    const seqId = this.chrToIndex && this.chrToIndex[seqName]\n    return this.index.indexCov(seqId, start, end)\n  }\n}\n","var AsyncGenerator = require(\"./AsyncGenerator\");\n\nfunction _wrapAsyncGenerator(fn) {\n  return function () {\n    return new AsyncGenerator(fn.apply(this, arguments));\n  };\n}\n\nmodule.exports = _wrapAsyncGenerator;","module.exports = require(\"core-js-pure/features/symbol/async-iterator\");","function _AwaitValue(value) {\n  this.wrapped = value;\n}\n\nmodule.exports = _AwaitValue;","var AwaitValue = require(\"./AwaitValue\");\n\nfunction _awaitAsyncGenerator(value) {\n  return new AwaitValue(value);\n}\n\nmodule.exports = _awaitAsyncGenerator;","var _Symbol$iterator = require(\"../core-js/symbol/iterator\");\n\nvar _Symbol = require(\"../core-js/symbol\");\n\nvar _Promise = require(\"../core-js/promise\");\n\nfunction _asyncGeneratorDelegate(inner, awaitWrap) {\n  var iter = {},\n      waiting = false;\n\n  function pump(key, value) {\n    waiting = true;\n    value = new _Promise(function (resolve) {\n      resolve(inner[key](value));\n    });\n    return {\n      done: false,\n      value: awaitWrap(value)\n    };\n  }\n\n  ;\n\n  if (typeof _Symbol === \"function\" && _Symbol$iterator) {\n    iter[_Symbol$iterator] = function () {\n      return this;\n    };\n  }\n\n  iter.next = function (value) {\n    if (waiting) {\n      waiting = false;\n      return value;\n    }\n\n    return pump(\"next\", value);\n  };\n\n  if (typeof inner[\"throw\"] === \"function\") {\n    iter[\"throw\"] = function (value) {\n      if (waiting) {\n        waiting = false;\n        throw value;\n      }\n\n      return pump(\"throw\", value);\n    };\n  }\n\n  if (typeof inner[\"return\"] === \"function\") {\n    iter[\"return\"] = function (value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump(\"return\", value);\n    };\n  }\n\n  return iter;\n}\n\nmodule.exports = _asyncGeneratorDelegate;","var _getIteratorMethod = require(\"../core-js/get-iterator-method\");\n\nvar _Symbol$iterator = require(\"../core-js/symbol/iterator\");\n\nvar _Symbol$asyncIterator = require(\"../core-js/symbol/async-iterator\");\n\nvar _Symbol = require(\"../core-js/symbol\");\n\nfunction _asyncIterator(iterable) {\n  var method;\n\n  if (typeof _Symbol !== \"undefined\") {\n    if (_Symbol$asyncIterator) {\n      method = iterable[_Symbol$asyncIterator];\n      if (method != null) return method.call(iterable);\n    }\n\n    if (_Symbol$iterator) {\n      method = _getIteratorMethod(iterable);\n      if (method != null) return method.call(iterable);\n    }\n  }\n\n  throw new TypeError(\"Object is not async iterable\");\n}\n\nmodule.exports = _asyncIterator;","/* eslint-disable @typescript-eslint/camelcase */\n/* eslint-disable @typescript-eslint/no-empty-function */\nimport Constants from './constants'\n\nconst SEQRET_DECODER = '=ACMGRSVTWYHKDBN'.split('').map(s => s.charCodeAt(0))\nconst CIGAR_DECODER = 'MIDNSHP=X???????'.split('')\n\n/**\n * Class of each BAM record returned by this API.\n */\nexport default class BamRecord {\n  private data: any\n  private bytes: any\n  private flags: any\n  private _id: number\n  private _refID: number\n  private _tagOffset: number | undefined = undefined\n  private _tagList: string[] = []\n  private _allTagsParsed = false\n  constructor(args: any) {\n    this.data = {}\n    this.bytes = {\n      start: args.bytes.start,\n      end: args.bytes.end,\n      byteArray: args.bytes.byteArray,\n    }\n    this._id = args.fileOffset\n    const { start, byteArray } = this.bytes\n    this._refID = byteArray.readInt32LE(start + 4)\n    this.data.start = byteArray.readInt32LE(start + 8)\n    this.flags = (byteArray.readInt32LE(start + 16) & 0xffff0000) >> 16\n  }\n\n  get(field: string) {\n    //@ts-ignore\n    if (this[field]) {\n      //@ts-ignore\n      if (this.data[field]) {\n        return this.data[field]\n      }\n      //@ts-ignore\n      this.data[field] = this[field]()\n      return this.data[field]\n    }\n    return this._get(field.toLowerCase())\n  }\n\n  end() {\n    return this.get('start') + (this.get('length_on_ref') || this.get('seq_length') || undefined)\n  }\n\n  seq_id() {\n    return this._refID\n  }\n\n  // same as get(), except requires lower-case arguments.  used\n  // internally to save lots of calls to field.toLowerCase()\n  _get(field: string) {\n    if (field in this.data) {\n      return this.data[field]\n    }\n    this.data[field] = this._parseTag(field)\n    return this.data[field]\n  }\n\n  _tags() {\n    this._parseAllTags()\n\n    let tags = ['seq']\n\n    if (!this.isSegmentUnmapped()) {\n      tags.push(\n        'start',\n        'end',\n        'strand',\n        'score',\n        'qual',\n        'MQ',\n        'CIGAR',\n        'length_on_ref',\n        'template_length',\n      )\n    }\n    if (this.isPaired()) {\n      tags.push('next_segment_position', 'pair_orientation')\n    }\n    tags = tags.concat(this._tagList || [])\n\n    Object.keys(this.data).forEach(k => {\n      if (k[0] !== '_' && k !== 'next_seq_id') {\n        tags.push(k)\n      }\n    })\n\n    const seen: { [key: string]: boolean } = {}\n    tags = tags.filter(t => {\n      if ((t in this.data && this.data[t] === undefined) || t === 'CG' || t === 'cg') {\n        return false\n      }\n\n      const lt = t.toLowerCase()\n      const s = seen[lt]\n      seen[lt] = true\n      return !s\n    })\n\n    return tags\n  }\n\n  parent() {\n    return undefined\n  }\n\n  children() {\n    return this.get('subfeatures')\n  }\n\n  id() {\n    return this._id\n  }\n\n  // special parsers\n  /**\n   * Mapping quality score.\n   */\n  mq() {\n    const mq = (this.get('_bin_mq_nl') & 0xff00) >> 8\n    return mq === 255 ? undefined : mq\n  }\n\n  score() {\n    return this.get('mq')\n  }\n\n  qual() {\n    return this.qualRaw()?.join(' ')\n  }\n\n  qualRaw() {\n    if (this.isSegmentUnmapped()) {\n      return undefined\n    }\n\n    const { byteArray } = this.bytes\n    const p =\n      this.bytes.start +\n      36 +\n      this.get('_l_read_name') +\n      this.get('_n_cigar_op') * 4 +\n      this.get('_seq_bytes')\n    const lseq = this.get('seq_length')\n    const qseq = Buffer.allocUnsafe(lseq)\n    for (let j = 0; j < lseq; ++j) {\n      qseq[j] = byteArray[p + j]\n    }\n    return qseq\n  }\n\n  strand() {\n    return this.isReverseComplemented() ? -1 : 1\n  }\n\n  multi_segment_next_segment_strand() {\n    if (this.isMateUnmapped()) {\n      return undefined\n    }\n    return this.isMateReverseComplemented() ? -1 : 1\n  }\n\n  name() {\n    return this.get('_read_name')\n  }\n\n  _read_name() {\n    const nl = this.get('_l_read_name')\n    return this.bytes.byteArray.toString(\n      'ascii',\n      this.bytes.start + 36,\n      this.bytes.start + 36 + nl - 1,\n    )\n  }\n\n  /**\n   * Get the value of a tag, parsing the tags as far as necessary.\n   * Only called if we have not already parsed that field.\n   */\n  _parseTag(tagName?: string) {\n    // if all of the tags have been parsed and we're still being\n    // called, we already know that we have no such tag, because\n    // it would already have been cached.\n    if (this._allTagsParsed) {\n      return undefined\n    }\n\n    const { byteArray } = this.bytes\n    let p =\n      this._tagOffset ||\n      this.bytes.start +\n        36 +\n        this.get('_l_read_name') +\n        this.get('_n_cigar_op') * 4 +\n        this.get('_seq_bytes') +\n        this.get('seq_length')\n\n    const blockEnd = this.bytes.end\n    let lcTag\n    while (p < blockEnd && lcTag !== tagName) {\n      const tag = String.fromCharCode(byteArray[p], byteArray[p + 1])\n      lcTag = tag.toLowerCase()\n      const type = String.fromCharCode(byteArray[p + 2])\n      p += 3\n\n      let value\n      switch (type) {\n        case 'A':\n          value = String.fromCharCode(byteArray[p])\n          p += 1\n          break\n        case 'i':\n          value = byteArray.readInt32LE(p)\n          p += 4\n          break\n        case 'I':\n          value = byteArray.readUInt32LE(p)\n          p += 4\n          break\n        case 'c':\n          value = byteArray.readInt8(p)\n          p += 1\n          break\n        case 'C':\n          value = byteArray.readUInt8(p)\n          p += 1\n          break\n        case 's':\n          value = byteArray.readInt16LE(p)\n          p += 2\n          break\n        case 'S':\n          value = byteArray.readUInt16LE(p)\n          p += 2\n          break\n        case 'f':\n          value = byteArray.readFloatLE(p)\n          p += 4\n          break\n        case 'Z':\n        case 'H':\n          value = ''\n          while (p <= blockEnd) {\n            const cc = byteArray[p++]\n            if (cc === 0) {\n              break\n            } else {\n              value += String.fromCharCode(cc)\n            }\n          }\n          break\n        case 'B': {\n          value = ''\n          const cc = byteArray[p++]\n          const Btype = String.fromCharCode(cc)\n          const limit = byteArray.readInt32LE(p)\n          p += 4\n          if (Btype === 'i') {\n            if (tag === 'CG') {\n              for (let k = 0; k < limit; k++) {\n                const cigop = byteArray.readInt32LE(p)\n                const lop = cigop >> 4\n                const op = CIGAR_DECODER[cigop & 0xf]\n                value += lop + op\n                p += 4\n              }\n            } else {\n              for (let k = 0; k < limit; k++) {\n                value += byteArray.readInt32LE(p)\n                if (k + 1 < limit) {\n                  value += ','\n                }\n                p += 4\n              }\n            }\n          }\n          if (Btype === 'I') {\n            if (tag === 'CG') {\n              for (let k = 0; k < limit; k++) {\n                const cigop = byteArray.readUInt32LE(p)\n                const lop = cigop >> 4\n                const op = CIGAR_DECODER[cigop & 0xf]\n                value += lop + op\n                p += 4\n              }\n            } else {\n              for (let k = 0; k < limit; k++) {\n                value += byteArray.readUInt32LE(p)\n                if (k + 1 < limit) {\n                  value += ','\n                }\n                p += 4\n              }\n            }\n          }\n          if (Btype === 's') {\n            for (let k = 0; k < limit; k++) {\n              value += byteArray.readInt16LE(p)\n              if (k + 1 < limit) {\n                value += ','\n              }\n              p += 2\n            }\n          }\n          if (Btype === 'S') {\n            for (let k = 0; k < limit; k++) {\n              value += byteArray.readUInt16LE(p)\n              if (k + 1 < limit) {\n                value += ','\n              }\n              p += 2\n            }\n          }\n          if (Btype === 'c') {\n            for (let k = 0; k < limit; k++) {\n              value += byteArray.readInt8(p)\n              if (k + 1 < limit) {\n                value += ','\n              }\n              p += 1\n            }\n          }\n          if (Btype === 'C') {\n            for (let k = 0; k < limit; k++) {\n              value += byteArray.readUInt8(p)\n              if (k + 1 < limit) {\n                value += ','\n              }\n              p += 1\n            }\n          }\n          if (Btype === 'f') {\n            for (let k = 0; k < limit; k++) {\n              value += byteArray.readFloatLE(p)\n              if (k + 1 < limit) {\n                value += ','\n              }\n              p += 4\n            }\n          }\n          break\n        }\n        default:\n          console.warn(`Unknown BAM tag type '${type}', tags may be incomplete`)\n          value = undefined\n          p = blockEnd // stop parsing tags\n      }\n\n      this._tagOffset = p\n\n      this._tagList.push(tag)\n      if (lcTag === tagName) {\n        return value\n      }\n\n      this.data[lcTag] = value\n    }\n    this._allTagsParsed = true\n    return undefined\n  }\n\n  _parseAllTags() {\n    this._parseTag('')\n  }\n\n  _parseCigar(cigar: string) {\n    return (\n      //@ts-ignore\n      cigar.match(/\\d+\\D/g).map((op: string) => [op.match(/\\D/)[0].toUpperCase(), parseInt(op, 10)])\n    )\n  }\n\n  /**\n   * @returns {boolean} true if the read is paired, regardless of whether both segments are mapped\n   */\n  isPaired() {\n    return !!(this.flags & Constants.BAM_FPAIRED)\n  }\n\n  /** @returns {boolean} true if the read is paired, and both segments are mapped */\n  isProperlyPaired() {\n    return !!(this.flags & Constants.BAM_FPROPER_PAIR)\n  }\n\n  /** @returns {boolean} true if the read itself is unmapped; conflictive with isProperlyPaired */\n  isSegmentUnmapped() {\n    return !!(this.flags & Constants.BAM_FUNMAP)\n  }\n\n  /** @returns {boolean} true if the read itself is unmapped; conflictive with isProperlyPaired */\n  isMateUnmapped() {\n    return !!(this.flags & Constants.BAM_FMUNMAP)\n  }\n\n  /** @returns {boolean} true if the read is mapped to the reverse strand */\n  isReverseComplemented() {\n    return !!(this.flags & Constants.BAM_FREVERSE)\n  }\n\n  /** @returns {boolean} true if the mate is mapped to the reverse strand */\n  isMateReverseComplemented() {\n    return !!(this.flags & Constants.BAM_FMREVERSE)\n  }\n\n  /** @returns {boolean} true if this is read number 1 in a pair */\n  isRead1() {\n    return !!(this.flags & Constants.BAM_FREAD1)\n  }\n\n  /** @returns {boolean} true if this is read number 2 in a pair */\n  isRead2() {\n    return !!(this.flags & Constants.BAM_FREAD2)\n  }\n\n  /** @returns {boolean} true if this is a secondary alignment */\n  isSecondary() {\n    return !!(this.flags & Constants.BAM_FSECONDARY)\n  }\n\n  /** @returns {boolean} true if this read has failed QC checks */\n  isFailedQc() {\n    return !!(this.flags & Constants.BAM_FQCFAIL)\n  }\n\n  /** @returns {boolean} true if the read is an optical or PCR duplicate */\n  isDuplicate() {\n    return !!(this.flags & Constants.BAM_FDUP)\n  }\n\n  /** @returns {boolean} true if this is a supplementary alignment */\n  isSupplementary() {\n    return !!(this.flags & Constants.BAM_FSUPPLEMENTARY)\n  }\n\n  cigar() {\n    if (this.isSegmentUnmapped()) {\n      return undefined\n    }\n\n    const { byteArray, start } = this.bytes\n    const numCigarOps = this.get('_n_cigar_op')\n    let p = start + 36 + this.get('_l_read_name')\n    const seqLen = this.get('seq_length')\n    let cigar = ''\n    let lref = 0\n\n    // check for CG tag by inspecting whether the CIGAR field\n    // contains a clip that consumes entire seqLen\n    let cigop = byteArray.readInt32LE(p)\n    let lop = cigop >> 4\n    let op = CIGAR_DECODER[cigop & 0xf]\n    if (op === 'S' && lop === seqLen) {\n      // if there is a CG the second CIGAR field will\n      // be a N tag the represents the length on ref\n      p += 4\n      cigop = byteArray.readInt32LE(p)\n      lop = cigop >> 4\n      op = CIGAR_DECODER[cigop & 0xf]\n      if (op !== 'N') {\n        console.warn('CG tag with no N tag')\n      }\n      this.data.length_on_ref = lop\n      return this.get('CG')\n    } else {\n      for (let c = 0; c < numCigarOps; ++c) {\n        cigop = byteArray.readInt32LE(p)\n        lop = cigop >> 4\n        op = CIGAR_DECODER[cigop & 0xf]\n        cigar += lop + op\n\n        // soft clip, hard clip, and insertion don't count toward\n        // the length on the reference\n        if (op !== 'H' && op !== 'S' && op !== 'I') {\n          lref += lop\n        }\n\n        p += 4\n      }\n\n      this.data.length_on_ref = lref\n      return cigar\n    }\n  }\n\n  _flags() {}\n\n  length_on_ref() {\n    this.get('cigar') // the length_on_ref is set as a\n    // side effect of the CIGAR parsing\n    return this.data.length_on_ref\n  }\n\n  _n_cigar_op() {\n    return this.get('_flag_nc') & 0xffff\n  }\n\n  _l_read_name() {\n    return this.get('_bin_mq_nl') & 0xff\n  }\n\n  /**\n   * number of bytes in the sequence field\n   */\n  _seq_bytes() {\n    return (this.get('seq_length') + 1) >> 1\n  }\n\n  getReadBases() {\n    return this.seq()\n  }\n\n  seq() {\n    const { byteArray } = this.bytes\n    const p = this.bytes.start + 36 + this.get('_l_read_name') + this.get('_n_cigar_op') * 4\n    const seqBytes = this.get('_seq_bytes')\n    const len = this.get('seq_length')\n    let buf = ''\n    let i = 0\n    for (let j = 0; j < seqBytes; ++j) {\n      const sb = byteArray[p + j]\n      buf += String.fromCharCode(SEQRET_DECODER[(sb & 0xf0) >> 4])\n      i++\n      if (i < len) {\n        buf += String.fromCharCode(SEQRET_DECODER[sb & 0x0f])\n        i++\n      }\n    }\n    return buf\n  }\n\n  // adapted from igv.js\n  getPairOrientation() {\n    if (!this.isSegmentUnmapped() && !this.isMateUnmapped() && this._refID === this._next_refid()) {\n      const s1 = this.isReverseComplemented() ? 'R' : 'F'\n      const s2 = this.isMateReverseComplemented() ? 'R' : 'F'\n      let o1 = ' '\n      let o2 = ' '\n      if (this.isRead1()) {\n        o1 = '1'\n        o2 = '2'\n      } else if (this.isRead2()) {\n        o1 = '2'\n        o2 = '1'\n      }\n\n      const tmp = []\n      const isize = this.template_length()\n      if (isize > 0) {\n        tmp[0] = s1\n        tmp[1] = o1\n        tmp[2] = s2\n        tmp[3] = o2\n      } else {\n        tmp[2] = s1\n        tmp[3] = o1\n        tmp[0] = s2\n        tmp[1] = o2\n      }\n      return tmp.join('')\n    }\n    return null\n  }\n\n  _bin_mq_nl() {\n    return this.bytes.byteArray.readInt32LE(this.bytes.start + 12)\n  }\n\n  _flag_nc() {\n    return this.bytes.byteArray.readInt32LE(this.bytes.start + 16)\n  }\n\n  seq_length() {\n    return this.bytes.byteArray.readInt32LE(this.bytes.start + 20)\n  }\n\n  _next_refid() {\n    return this.bytes.byteArray.readInt32LE(this.bytes.start + 24)\n  }\n\n  _next_pos() {\n    return this.bytes.byteArray.readInt32LE(this.bytes.start + 28)\n  }\n\n  template_length() {\n    return this.bytes.byteArray.readInt32LE(this.bytes.start + 32)\n  }\n\n  toJSON() {\n    const data: { [key: string]: any } = {}\n    Object.keys(this).forEach(k => {\n      if (k.charAt(0) === '_' || k === 'bytes') {\n        return\n      }\n      //@ts-ignore\n      data[k] = this[k]\n    })\n\n    return data\n  }\n}\n","export function parseHeaderText(text: string) {\n  const lines = text.split(/\\r?\\n/)\n  const data: { tag: string; data: { tag: string; value: string }[] }[] = []\n  lines.forEach(line => {\n    const [tag, ...fields] = line.split(/\\t/)\n    const parsedFields = fields.map(f => {\n      const [fieldTag, value] = f.split(':', 2)\n      return { tag: fieldTag, value }\n    })\n    if (tag) {\n      data.push({ tag: tag.substr(1), data: parsedFields })\n    }\n  })\n  return data\n}\n","module.exports = require(\"core-js-pure/features/instance/index-of\");","module.exports = require(\"core-js-pure/stable/object/define-property\");","var parent = require('../../es/object/define-property');\n\nmodule.exports = parent;\n","var parent = require('../../es/array/is-array');\n\nmodule.exports = parent;\n","require('../modules/web.dom-collections.iterator');\nrequire('../modules/es.string.iterator');\nvar getIteratorMethod = require('../internals/get-iterator-method');\n\nmodule.exports = getIteratorMethod;\n","var parent = require('../../es/symbol');\n\nmodule.exports = parent;\n","var parent = require('../../es/array/from');\n\nmodule.exports = parent;\n","var parent = require('../../es/object/define-properties');\n\nmodule.exports = parent;\n","require('../../modules/es.object.define-properties');\nvar path = require('../../internals/path');\n\nvar Object = path.Object;\n\nvar defineProperties = module.exports = function defineProperties(T, D) {\n  return Object.defineProperties(T, D);\n};\n\nif (Object.defineProperties.sham) defineProperties.sham = true;\n","var $ = require('../internals/export');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar defineProperties = require('../internals/object-define-properties');\n\n// `Object.defineProperties` method\n// https://tc39.github.io/ecma262/#sec-object.defineproperties\n$({ target: 'Object', stat: true, forced: !DESCRIPTORS, sham: !DESCRIPTORS }, {\n  defineProperties: defineProperties\n});\n","var parent = require('../../es/object/get-own-property-descriptors');\n\nmodule.exports = parent;\n","require('../../modules/es.object.get-own-property-descriptors');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Object.getOwnPropertyDescriptors;\n","var $ = require('../internals/export');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar ownKeys = require('../internals/own-keys');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar createProperty = require('../internals/create-property');\n\n// `Object.getOwnPropertyDescriptors` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptors\n$({ target: 'Object', stat: true, sham: !DESCRIPTORS }, {\n  getOwnPropertyDescriptors: function getOwnPropertyDescriptors(object) {\n    var O = toIndexedObject(object);\n    var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n    var keys = ownKeys(O);\n    var result = {};\n    var index = 0;\n    var key, descriptor;\n    while (keys.length > index) {\n      descriptor = getOwnPropertyDescriptor(O, key = keys[index++]);\n      if (descriptor !== undefined) createProperty(result, key, descriptor);\n    }\n    return result;\n  }\n});\n","var getBuiltIn = require('../internals/get-built-in');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? keys.concat(getOwnPropertySymbols(it)) : keys;\n};\n","var parent = require('../../es/object/get-own-property-descriptor');\n\nmodule.exports = parent;\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar nativeGetOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeGetOwnPropertyDescriptor(1); });\nvar FORCED = !DESCRIPTORS || FAILS_ON_PRIMITIVES;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptor\n$({ target: 'Object', stat: true, forced: FORCED, sham: !DESCRIPTORS }, {\n  getOwnPropertyDescriptor: function getOwnPropertyDescriptor(it, key) {\n    return nativeGetOwnPropertyDescriptor(toIndexedObject(it), key);\n  }\n});\n","var parent = require('../../es/object/get-own-property-symbols');\n\nmodule.exports = parent;\n","var parent = require('../../es/reflect/construct');\n\nmodule.exports = parent;\n","module.exports = require(\"core-js-pure/features/array/is-array\");","var _getIterator = require(\"../core-js/get-iterator\");\n\nvar _isIterable = require(\"../core-js/is-iterable\");\n\nvar _Symbol = require(\"../core-js/symbol\");\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (typeof _Symbol === \"undefined\" || !_isIterable(Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = _getIterator(arr), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nmodule.exports = _iterableToArrayLimit;","module.exports = require(\"core-js-pure/features/instance/slice\");","function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nmodule.exports = _arrayLikeToArray;","module.exports = require(\"core-js-pure/features/object/create\");","var _Object$setPrototypeOf = require(\"../core-js/object/set-prototype-of\");\n\nfunction _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = _Object$setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","module.exports = require(\"core-js-pure/features/object/get-prototype-of\");","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar abortcontroller_ponyfill_1 = require(\"./abortcontroller-ponyfill\");\nvar AggregateAbortController_1 = __importDefault(require(\"./AggregateAbortController\"));\nvar AbortablePromiseCache = /** @class */ (function () {\n    function AbortablePromiseCache(_a) {\n        var fill = _a.fill, cache = _a.cache;\n        if (typeof fill !== 'function')\n            throw new TypeError('must pass a fill function');\n        if (typeof cache !== 'object')\n            throw new TypeError('must pass a cache object');\n        if (typeof cache.get !== 'function' ||\n            typeof cache.set !== 'function' ||\n            typeof cache.delete !== 'function')\n            throw new TypeError('cache must implement get(key), set(key, val), and and delete(key)');\n        this.cache = cache;\n        this.fillCallback = fill;\n    }\n    AbortablePromiseCache.isAbortException = function (exception) {\n        return (\n        // DOMException\n        exception.name === 'AbortError' ||\n            // standard-ish non-DOM abort exception\n            //@ts-ignore\n            exception.code === 'ERR_ABORTED' ||\n            // stringified DOMException\n            exception.message === 'AbortError: aborted' ||\n            // stringified standard-ish exception\n            exception.message === 'Error: aborted');\n    };\n    AbortablePromiseCache.prototype.evict = function (key, entry) {\n        if (this.cache.get(key) === entry)\n            this.cache.delete(key);\n    };\n    AbortablePromiseCache.prototype.fill = function (key, data, signal) {\n        var _this = this;\n        var aborter = new AggregateAbortController_1.default();\n        var newEntry = {\n            aborter: aborter,\n            promise: this.fillCallback(data, aborter.signal),\n            settled: false,\n            get aborted() {\n                return this.aborter.signal.aborted;\n            },\n        };\n        newEntry.aborter.addSignal(signal);\n        // remove the fill from the cache when its abortcontroller fires, if still in there\n        newEntry.aborter.signal.addEventListener('abort', function () {\n            _this.evict(key, newEntry);\n        });\n        // chain off the cached promise to record when it settles\n        newEntry.promise\n            .then(function () {\n            newEntry.settled = true;\n        }, function (exception) {\n            newEntry.settled = true;\n            // if the fill throws an error (including abort) and is still in the cache, remove it\n            _this.evict(key, newEntry);\n        })\n            .catch(function (e) {\n            // this will only be reached if there is some kind of\n            // bad bug in this library\n            console.error(e);\n            throw e;\n        });\n        this.cache.set(key, newEntry);\n    };\n    AbortablePromiseCache.checkSinglePromise = function (promise, signal) {\n        // check just this signal for having been aborted, and abort the\n        // promise if it was, regardless of what happened with the cached\n        // response\n        function checkForSingleAbort() {\n            if (signal && signal.aborted)\n                throw Object.assign(new Error('aborted'), { code: 'ERR_ABORTED' });\n        }\n        return promise.then(function (result) {\n            checkForSingleAbort();\n            return result;\n        }, function (error) {\n            checkForSingleAbort();\n            throw error;\n        });\n    };\n    AbortablePromiseCache.prototype.has = function (key) {\n        return this.cache.has(key);\n    };\n    /**\n     * @param {any} key cache key to use for this request\n     * @param {any} data data passed as the first argument to the fill callback\n     * @param {AbortSignal} [signal] optional AbortSignal object that aborts the request\n     */\n    AbortablePromiseCache.prototype.get = function (key, data, signal) {\n        if (!signal && data instanceof abortcontroller_ponyfill_1.AbortSignal)\n            throw new TypeError('second get argument appears to be an AbortSignal, perhaps you meant to pass `null` for the fill data?');\n        var cacheEntry = this.cache.get(key);\n        if (cacheEntry) {\n            if (cacheEntry.aborted) {\n                // if it's aborted but has not realized it yet, evict it and redispatch\n                this.evict(key, cacheEntry);\n                return this.get(key, data, signal);\n            }\n            if (cacheEntry.settled)\n                // too late to abort, just return it\n                return cacheEntry.promise;\n            // request is in-flight, add this signal to its list of signals,\n            // or if there is no signal, the aborter will become non-abortable\n            cacheEntry.aborter.addSignal(signal);\n            return AbortablePromiseCache.checkSinglePromise(cacheEntry.promise, signal);\n        }\n        // if we got here, it is not in the cache. fill.\n        this.fill(key, data, signal);\n        return AbortablePromiseCache.checkSinglePromise(this.cache.get(key).promise, signal);\n    };\n    /**\n     * delete the given entry from the cache. if it exists and its fill request has\n     * not yet settled, the fill will be signaled to abort.\n     *\n     * @param {any} key\n     */\n    AbortablePromiseCache.prototype.delete = function (key) {\n        var cachedEntry = this.cache.get(key);\n        if (cachedEntry) {\n            if (!cachedEntry.settled)\n                cachedEntry.aborter.abort();\n            this.cache.delete(key);\n        }\n    };\n    /**\n     * Clear all requests from the cache. Aborts any that have not settled.\n     * @returns {number} count of entries deleted\n     */\n    AbortablePromiseCache.prototype.clear = function () {\n        // iterate without needing regenerator-runtime\n        var keyIter = this.cache.keys();\n        var deleteCount = 0;\n        for (var result = keyIter.next(); !result.done; result = keyIter.next()) {\n            this.delete(result.value);\n            deleteCount += 1;\n        }\n        return deleteCount;\n    };\n    return AbortablePromiseCache;\n}());\nexports.default = AbortablePromiseCache;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar abortcontroller_ponyfill_1 = require(\"./abortcontroller-ponyfill\");\nvar NullSignal = /** @class */ (function () {\n    function NullSignal() {\n    }\n    return NullSignal;\n}());\n/**\n * aggregates a number of abort signals, will only fire the aggregated\n * abort if all of the input signals have been aborted\n */\nvar AggregateAbortController = /** @class */ (function () {\n    function AggregateAbortController() {\n        this.signals = new Set();\n        this.abortController = new abortcontroller_ponyfill_1.AbortController();\n    }\n    /**\n     * @param {AbortSignal} [signal] optional AbortSignal to add. if falsy,\n     *  will be treated as a null-signal, and this abortcontroller will no\n     *  longer be abortable.\n     */\n    //@ts-ignore\n    AggregateAbortController.prototype.addSignal = function (signal) {\n        var _this = this;\n        if (signal === void 0) { signal = new NullSignal(); }\n        if (this.signal.aborted) {\n            throw new Error('cannot add a signal, already aborted!');\n        }\n        // note that a NullSignal will never fire, so if we\n        // have one this thing will never actually abort\n        this.signals.add(signal);\n        if (signal.aborted) {\n            // handle the abort immediately if it is already aborted\n            // for some reason\n            this.handleAborted(signal);\n        }\n        else if (typeof signal.addEventListener === 'function') {\n            signal.addEventListener('abort', function () {\n                _this.handleAborted(signal);\n            });\n        }\n    };\n    AggregateAbortController.prototype.handleAborted = function (signal) {\n        this.signals.delete(signal);\n        if (this.signals.size === 0) {\n            this.abortController.abort();\n        }\n    };\n    Object.defineProperty(AggregateAbortController.prototype, \"signal\", {\n        get: function () {\n            return this.abortController.signal;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    AggregateAbortController.prototype.abort = function () {\n        this.abortController.abort();\n    };\n    return AggregateAbortController;\n}());\nexports.default = AggregateAbortController;\n","module.exports = require(\"core-js-pure/stable/number/min-safe-integer\");","module.exports = require(\"core-js-pure/stable/number/max-safe-integer\");","module.exports = require(\"core-js-pure/stable/set-timeout\");","require('../modules/web.timers');\nvar path = require('../internals/path');\n\nmodule.exports = path.setTimeout;\n","var $ = require('../internals/export');\nvar global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar slice = [].slice;\nvar MSIE = /MSIE .\\./.test(userAgent); // <- dirty ie9- check\n\nvar wrap = function (scheduler) {\n  return function (handler, timeout /* , ...arguments */) {\n    var boundArgs = arguments.length > 2;\n    var args = boundArgs ? slice.call(arguments, 2) : undefined;\n    return scheduler(boundArgs ? function () {\n      // eslint-disable-next-line no-new-func\n      (typeof handler == 'function' ? handler : Function(handler)).apply(this, args);\n    } : handler, timeout);\n  };\n};\n\n// ie9- setTimeout & setInterval additional parameters fix\n// https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers\n$({ global: true, bind: true, forced: MSIE }, {\n  // `setTimeout` method\n  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-settimeout\n  setTimeout: wrap(global.setTimeout),\n  // `setInterval` method\n  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-setinterval\n  setInterval: wrap(global.setInterval)\n});\n","module.exports = require(\"core-js-pure/features/object/get-own-property-descriptor\");","var parent = require('../../es/object/get-own-property-descriptor');\n\nmodule.exports = parent;\n","module.exports = require(\"core-js-pure/features/weak-map\");","var parent = require('../../es/weak-map');\nrequire('../../modules/esnext.weak-map.from');\nrequire('../../modules/esnext.weak-map.of');\nrequire('../../modules/esnext.weak-map.delete-all');\nrequire('../../modules/esnext.weak-map.upsert');\n\nmodule.exports = parent;\n","require('../../modules/es.object.to-string');\nrequire('../../modules/es.weak-map');\nrequire('../../modules/web.dom-collections.iterator');\nvar path = require('../../internals/path');\n\nmodule.exports = path.WeakMap;\n","'use strict';\nvar global = require('../internals/global');\nvar redefineAll = require('../internals/redefine-all');\nvar InternalMetadataModule = require('../internals/internal-metadata');\nvar collection = require('../internals/collection');\nvar collectionWeak = require('../internals/collection-weak');\nvar isObject = require('../internals/is-object');\nvar enforceIternalState = require('../internals/internal-state').enforce;\nvar NATIVE_WEAK_MAP = require('../internals/native-weak-map');\n\nvar IS_IE11 = !global.ActiveXObject && 'ActiveXObject' in global;\nvar isExtensible = Object.isExtensible;\nvar InternalWeakMap;\n\nvar wrapper = function (init) {\n  return function WeakMap() {\n    return init(this, arguments.length ? arguments[0] : undefined);\n  };\n};\n\n// `WeakMap` constructor\n// https://tc39.github.io/ecma262/#sec-weakmap-constructor\nvar $WeakMap = module.exports = collection('WeakMap', wrapper, collectionWeak);\n\n// IE11 WeakMap frozen keys fix\n// We can't use feature detection because it crash some old IE builds\n// https://github.com/zloirock/core-js/issues/485\nif (NATIVE_WEAK_MAP && IS_IE11) {\n  InternalWeakMap = collectionWeak.getConstructor(wrapper, 'WeakMap', true);\n  InternalMetadataModule.REQUIRED = true;\n  var WeakMapPrototype = $WeakMap.prototype;\n  var nativeDelete = WeakMapPrototype['delete'];\n  var nativeHas = WeakMapPrototype.has;\n  var nativeGet = WeakMapPrototype.get;\n  var nativeSet = WeakMapPrototype.set;\n  redefineAll(WeakMapPrototype, {\n    'delete': function (key) {\n      if (isObject(key) && !isExtensible(key)) {\n        var state = enforceIternalState(this);\n        if (!state.frozen) state.frozen = new InternalWeakMap();\n        return nativeDelete.call(this, key) || state.frozen['delete'](key);\n      } return nativeDelete.call(this, key);\n    },\n    has: function has(key) {\n      if (isObject(key) && !isExtensible(key)) {\n        var state = enforceIternalState(this);\n        if (!state.frozen) state.frozen = new InternalWeakMap();\n        return nativeHas.call(this, key) || state.frozen.has(key);\n      } return nativeHas.call(this, key);\n    },\n    get: function get(key) {\n      if (isObject(key) && !isExtensible(key)) {\n        var state = enforceIternalState(this);\n        if (!state.frozen) state.frozen = new InternalWeakMap();\n        return nativeHas.call(this, key) ? nativeGet.call(this, key) : state.frozen.get(key);\n      } return nativeGet.call(this, key);\n    },\n    set: function set(key, value) {\n      if (isObject(key) && !isExtensible(key)) {\n        var state = enforceIternalState(this);\n        if (!state.frozen) state.frozen = new InternalWeakMap();\n        nativeHas.call(this, key) ? nativeSet.call(this, key, value) : state.frozen.set(key, value);\n      } else nativeSet.call(this, key, value);\n      return this;\n    }\n  });\n}\n","'use strict';\nvar redefineAll = require('../internals/redefine-all');\nvar getWeakData = require('../internals/internal-metadata').getWeakData;\nvar anObject = require('../internals/an-object');\nvar isObject = require('../internals/is-object');\nvar anInstance = require('../internals/an-instance');\nvar iterate = require('../internals/iterate');\nvar ArrayIterationModule = require('../internals/array-iteration');\nvar $has = require('../internals/has');\nvar InternalStateModule = require('../internals/internal-state');\n\nvar setInternalState = InternalStateModule.set;\nvar internalStateGetterFor = InternalStateModule.getterFor;\nvar find = ArrayIterationModule.find;\nvar findIndex = ArrayIterationModule.findIndex;\nvar id = 0;\n\n// fallback for uncaught frozen keys\nvar uncaughtFrozenStore = function (store) {\n  return store.frozen || (store.frozen = new UncaughtFrozenStore());\n};\n\nvar UncaughtFrozenStore = function () {\n  this.entries = [];\n};\n\nvar findUncaughtFrozen = function (store, key) {\n  return find(store.entries, function (it) {\n    return it[0] === key;\n  });\n};\n\nUncaughtFrozenStore.prototype = {\n  get: function (key) {\n    var entry = findUncaughtFrozen(this, key);\n    if (entry) return entry[1];\n  },\n  has: function (key) {\n    return !!findUncaughtFrozen(this, key);\n  },\n  set: function (key, value) {\n    var entry = findUncaughtFrozen(this, key);\n    if (entry) entry[1] = value;\n    else this.entries.push([key, value]);\n  },\n  'delete': function (key) {\n    var index = findIndex(this.entries, function (it) {\n      return it[0] === key;\n    });\n    if (~index) this.entries.splice(index, 1);\n    return !!~index;\n  }\n};\n\nmodule.exports = {\n  getConstructor: function (wrapper, CONSTRUCTOR_NAME, IS_MAP, ADDER) {\n    var C = wrapper(function (that, iterable) {\n      anInstance(that, C, CONSTRUCTOR_NAME);\n      setInternalState(that, {\n        type: CONSTRUCTOR_NAME,\n        id: id++,\n        frozen: undefined\n      });\n      if (iterable != undefined) iterate(iterable, that[ADDER], that, IS_MAP);\n    });\n\n    var getInternalState = internalStateGetterFor(CONSTRUCTOR_NAME);\n\n    var define = function (that, key, value) {\n      var state = getInternalState(that);\n      var data = getWeakData(anObject(key), true);\n      if (data === true) uncaughtFrozenStore(state).set(key, value);\n      else data[state.id] = value;\n      return that;\n    };\n\n    redefineAll(C.prototype, {\n      // 23.3.3.2 WeakMap.prototype.delete(key)\n      // 23.4.3.3 WeakSet.prototype.delete(value)\n      'delete': function (key) {\n        var state = getInternalState(this);\n        if (!isObject(key)) return false;\n        var data = getWeakData(key);\n        if (data === true) return uncaughtFrozenStore(state)['delete'](key);\n        return data && $has(data, state.id) && delete data[state.id];\n      },\n      // 23.3.3.4 WeakMap.prototype.has(key)\n      // 23.4.3.4 WeakSet.prototype.has(value)\n      has: function has(key) {\n        var state = getInternalState(this);\n        if (!isObject(key)) return false;\n        var data = getWeakData(key);\n        if (data === true) return uncaughtFrozenStore(state).has(key);\n        return data && $has(data, state.id);\n      }\n    });\n\n    redefineAll(C.prototype, IS_MAP ? {\n      // 23.3.3.3 WeakMap.prototype.get(key)\n      get: function get(key) {\n        var state = getInternalState(this);\n        if (isObject(key)) {\n          var data = getWeakData(key);\n          if (data === true) return uncaughtFrozenStore(state).get(key);\n          return data ? data[state.id] : undefined;\n        }\n      },\n      // 23.3.3.5 WeakMap.prototype.set(key, value)\n      set: function set(key, value) {\n        return define(this, key, value);\n      }\n    } : {\n      // 23.4.3.1 WeakSet.prototype.add(value)\n      add: function add(value) {\n        return define(this, value, true);\n      }\n    });\n\n    return C;\n  }\n};\n","var $ = require('../internals/export');\nvar from = require('../internals/collection-from');\n\n// `WeakMap.from` method\n// https://tc39.github.io/proposal-setmap-offrom/#sec-weakmap.from\n$({ target: 'WeakMap', stat: true }, {\n  from: from\n});\n","var $ = require('../internals/export');\nvar of = require('../internals/collection-of');\n\n// `WeakMap.of` method\n// https://tc39.github.io/proposal-setmap-offrom/#sec-weakmap.of\n$({ target: 'WeakMap', stat: true }, {\n  of: of\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar IS_PURE = require('../internals/is-pure');\nvar collectionDeleteAll = require('../internals/collection-delete-all');\n\n// `WeakMap.prototype.deleteAll` method\n// https://github.com/tc39/proposal-collection-methods\n$({ target: 'WeakMap', proto: true, real: true, forced: IS_PURE }, {\n  deleteAll: function deleteAll(/* ...elements */) {\n    return collectionDeleteAll.apply(this, arguments);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar IS_PURE = require('../internals/is-pure');\nvar $upsert = require('../internals/map-upsert');\n\n// `WeakMap.prototype.upsert` method\n// https://github.com/thumbsupep/proposal-upsert\n$({ target: 'WeakMap', proto: true, real: true, forced: IS_PURE }, {\n  upsert: $upsert\n});\n","module.exports = require(\"core-js-pure/stable/object/assign\");","module.exports = require(\"core-js-pure/stable/instance/reduce\");","module.exports = require(\"core-js-pure/stable/instance/bind\");","var _Symbol$asyncIterator = require(\"../core-js/symbol/async-iterator\");\n\nvar _Symbol = require(\"../core-js/symbol\");\n\nvar _Promise = require(\"../core-js/promise\");\n\nvar AwaitValue = require(\"./AwaitValue\");\n\nfunction AsyncGenerator(gen) {\n  var front, back;\n\n  function send(key, arg) {\n    return new _Promise(function (resolve, reject) {\n      var request = {\n        key: key,\n        arg: arg,\n        resolve: resolve,\n        reject: reject,\n        next: null\n      };\n\n      if (back) {\n        back = back.next = request;\n      } else {\n        front = back = request;\n        resume(key, arg);\n      }\n    });\n  }\n\n  function resume(key, arg) {\n    try {\n      var result = gen[key](arg);\n      var value = result.value;\n      var wrappedAwait = value instanceof AwaitValue;\n\n      _Promise.resolve(wrappedAwait ? value.wrapped : value).then(function (arg) {\n        if (wrappedAwait) {\n          resume(key === \"return\" ? \"return\" : \"next\", arg);\n          return;\n        }\n\n        settle(result.done ? \"return\" : \"normal\", arg);\n      }, function (err) {\n        resume(\"throw\", err);\n      });\n    } catch (err) {\n      settle(\"throw\", err);\n    }\n  }\n\n  function settle(type, value) {\n    switch (type) {\n      case \"return\":\n        front.resolve({\n          value: value,\n          done: true\n        });\n        break;\n\n      case \"throw\":\n        front.reject(value);\n        break;\n\n      default:\n        front.resolve({\n          value: value,\n          done: false\n        });\n        break;\n    }\n\n    front = front.next;\n\n    if (front) {\n      resume(front.key, front.arg);\n    } else {\n      back = null;\n    }\n  }\n\n  this._invoke = send;\n\n  if (typeof gen[\"return\"] !== \"function\") {\n    this[\"return\"] = undefined;\n  }\n}\n\nif (typeof _Symbol === \"function\" && _Symbol$asyncIterator) {\n  AsyncGenerator.prototype[_Symbol$asyncIterator] = function () {\n    return this;\n  };\n}\n\nAsyncGenerator.prototype.next = function (arg) {\n  return this._invoke(\"next\", arg);\n};\n\nAsyncGenerator.prototype[\"throw\"] = function (arg) {\n  return this._invoke(\"throw\", arg);\n};\n\nAsyncGenerator.prototype[\"return\"] = function (arg) {\n  return this._invoke(\"return\", arg);\n};\n\nmodule.exports = AsyncGenerator;","var parent = require('../../es/symbol/async-iterator');\n\nmodule.exports = parent;\n","require('../../modules/es.symbol.async-iterator');\nvar WrappedWellKnownSymbolModule = require('../../internals/well-known-symbol-wrapped');\n\nmodule.exports = WrappedWellKnownSymbolModule.f('asyncIterator');\n","module.exports = require(\"core-js-pure/stable/instance/flags\");","module.exports = require(\"core-js-pure/stable/parse-int\");","export default {\n  //  the read is paired in sequencing, no matter whether it is mapped in a pair\n  BAM_FPAIRED: 1,\n  //  the read is mapped in a proper pair\n  BAM_FPROPER_PAIR: 2,\n  //  the read itself is unmapped; conflictive with BAM_FPROPER_PAIR\n  BAM_FUNMAP: 4,\n  //  the mate is unmapped\n  BAM_FMUNMAP: 8,\n  //  the read is mapped to the reverse strand\n  BAM_FREVERSE: 16,\n  //  the mate is mapped to the reverse strand\n  BAM_FMREVERSE: 32,\n  //  this is read1\n  BAM_FREAD1: 64,\n  //  this is read2\n  BAM_FREAD2: 128,\n  //  not primary alignment\n  BAM_FSECONDARY: 256,\n  //  QC failure\n  BAM_FQCFAIL: 512,\n  //  optical or PCR duplicate\n  BAM_FDUP: 1024,\n  //  supplementary alignment\n  BAM_FSUPPLEMENTARY: 2048,\n}\n","var arrayWithHoles = require(\"./arrayWithHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableRest = require(\"./nonIterableRest\");\n\nfunction _toArray(arr) {\n  return arrayWithHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableRest();\n}\n\nmodule.exports = _toArray;","var _Array$from = require(\"../core-js/array/from\");\n\nvar _isIterable = require(\"../core-js/is-iterable\");\n\nvar _Symbol = require(\"../core-js/symbol\");\n\nfunction _iterableToArray(iter) {\n  if (typeof _Symbol !== \"undefined\" && _isIterable(Object(iter))) return _Array$from(iter);\n}\n\nmodule.exports = _iterableToArray;","import { BaseOpts, BamOpts } from './util'\nimport BamFile, { BAM_MAGIC } from './bamFile'\nimport 'cross-fetch/polyfill'\nimport Chunk from './chunk'\nimport { unzip } from '@gmod/bgzf-filehandle'\nimport { parseHeaderText } from './sam'\n\ninterface HeaderLine {\n  tag: string\n  value: string\n}\n\ninterface HtsgetChunk {\n  url: string\n  headers?: Record<string, string>\n}\nasync function concat(arr: { url: string }[], opts: Record<string, any>) {\n  const res = await Promise.all(\n    arr.map(async (chunk: HtsgetChunk) => {\n      const { url, headers } = chunk\n      if (url.startsWith('data:')) {\n        return Buffer.from(url.split(',')[1], 'base64')\n      } else {\n        //remove referer header, it is not even allowed to be specified\n        //@ts-ignore\n        //eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { referer, ...rest } = headers\n        const res = await fetch(url, { ...opts, headers: { ...opts.headers, ...rest } })\n        if (!res.ok) {\n          throw new Error(`Failed to fetch ${res.statusText}`)\n        }\n        return Buffer.from(await res.arrayBuffer())\n      }\n    }),\n  )\n\n  return Buffer.concat(await Promise.all(res.map(elt => unzip(elt))))\n}\n\nexport default class HtsgetFile extends BamFile {\n  private baseUrl: string\n\n  private trackId: string\n\n  constructor(args: { trackId: string; baseUrl: string }) {\n    // @ts-ignore override bam defaults\n    super({ bamFilehandle: '?', baiFilehandle: '?' })\n    this.baseUrl = args.baseUrl\n    this.trackId = args.trackId\n  }\n\n  async *streamRecordsForRange(\n    chr: string,\n    min: number,\n    max: number,\n    opts: BamOpts = { viewAsPairs: false, pairAcrossChr: false, maxInsertSize: 200000 },\n  ) {\n    const base = `${this.baseUrl}/${this.trackId}`\n    const url = `${base}?referenceName=${chr}&start=${min}&end=${max}&format=BAM`\n    const chrId = this.chrToIndex && this.chrToIndex[chr]\n    const result = await fetch(url, { ...opts })\n    if (!result.ok) {\n      throw new Error(result.statusText)\n    }\n    const data = await result.json()\n    const uncba = await concat(data.htsget.urls.slice(1), opts)\n    const chunk = {\n      buffer: uncba,\n      chunk: { minv: { dataPosition: 0 } },\n      toString() {\n        return `${chr}_${min}_${max}`\n      },\n    }\n\n    yield* this._fetchChunkFeatures(\n      // @ts-ignore\n      [chunk],\n      chrId,\n      min,\n      max,\n      opts,\n    )\n  }\n\n  //@ts-ignore\n  async _readChunk(params: { chunk: { buffer: Buffer; chunk: Chunk }; opts: BaseOpts }) {\n    const { chunk } = params\n    const { buffer, chunk: c2 } = chunk\n    return { data: buffer, cpositions: null, dpositions: null, chunk: c2 }\n  }\n\n  async getHeader(opts: BaseOpts = {}) {\n    const url = `${this.baseUrl}/${this.trackId}?referenceName=na&class=header`\n    const result = await fetch(url, opts)\n    if (!result.ok) {\n      throw new Error(`Failed to fetch ${result.statusText}`)\n    }\n    const data = await result.json()\n    const uncba = await concat(data.htsget.urls, opts)\n\n    if (uncba.readInt32LE(0) !== BAM_MAGIC) {\n      throw new Error('Not a BAM file')\n    }\n    const headLen = uncba.readInt32LE(4)\n\n    const headerText = uncba.toString('utf8', 8, 8 + headLen)\n    const samHeader = parseHeaderText(headerText)\n\n    // use the @SQ lines in the header to figure out the\n    // mapping between ref ref ID numbers and names\n    const idToName: string[] = []\n    const nameToId: Record<string, number> = {}\n    const sqLines = samHeader.filter((l: { tag: string }) => l.tag === 'SQ')\n    sqLines.forEach((sqLine: { data: HeaderLine[] }, refId: number) => {\n      sqLine.data.forEach((item: HeaderLine) => {\n        if (item.tag === 'SN') {\n          // this is the ref name\n          const refName = item.value\n          nameToId[refName] = refId\n          idToName[refId] = refName\n        }\n      })\n    })\n    this.chrToIndex = nameToId\n    this.indexToChr = idToName\n    return samHeader\n  }\n}\n","var _indexOfInstanceProperty = require(\"../core-js/instance/index-of\");\n\nvar _Object$getOwnPropertySymbols = require(\"../core-js/object/get-own-property-symbols\");\n\nvar objectWithoutPropertiesLoose = require(\"./objectWithoutPropertiesLoose\");\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (_Object$getOwnPropertySymbols) {\n    var sourceSymbolKeys = _Object$getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (_indexOfInstanceProperty(excluded).call(excluded, key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nmodule.exports = _objectWithoutProperties;","module.exports = require(\"core-js-pure/features/object/get-own-property-symbols\");","var parent = require('../../es/object/get-own-property-symbols');\n\nmodule.exports = parent;\n","var _indexOfInstanceProperty = require(\"../core-js/instance/index-of\");\n\nvar _Object$keys = require(\"../core-js/object/keys\");\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n\n  var sourceKeys = _Object$keys(source);\n\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (_indexOfInstanceProperty(excluded).call(excluded, key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nmodule.exports = _objectWithoutPropertiesLoose;","module.exports = require(\"core-js-pure/features/object/keys\");","var parent = require('../../es/object/keys');\n\nmodule.exports = parent;\n","module.exports = require(\"core-js-pure/stable/instance/starts-with\");","var parent = require('../../es/instance/starts-with');\n\nmodule.exports = parent;\n","var startsWith = require('../string/virtual/starts-with');\n\nvar StringPrototype = String.prototype;\n\nmodule.exports = function (it) {\n  var own = it.startsWith;\n  return typeof it === 'string' || it === StringPrototype\n    || (it instanceof String && own === StringPrototype.startsWith) ? startsWith : own;\n};\n","require('../../../modules/es.string.starts-with');\nvar entryVirtual = require('../../../internals/entry-virtual');\n\nmodule.exports = entryVirtual('String').startsWith;\n","'use strict';\nvar $ = require('../internals/export');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar toLength = require('../internals/to-length');\nvar notARegExp = require('../internals/not-a-regexp');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar correctIsRegExpLogic = require('../internals/correct-is-regexp-logic');\nvar IS_PURE = require('../internals/is-pure');\n\nvar nativeStartsWith = ''.startsWith;\nvar min = Math.min;\n\nvar CORRECT_IS_REGEXP_LOGIC = correctIsRegExpLogic('startsWith');\n// https://github.com/zloirock/core-js/pull/702\nvar MDN_POLYFILL_BUG = !IS_PURE && !CORRECT_IS_REGEXP_LOGIC && !!function () {\n  var descriptor = getOwnPropertyDescriptor(String.prototype, 'startsWith');\n  return descriptor && !descriptor.writable;\n}();\n\n// `String.prototype.startsWith` method\n// https://tc39.github.io/ecma262/#sec-string.prototype.startswith\n$({ target: 'String', proto: true, forced: !MDN_POLYFILL_BUG && !CORRECT_IS_REGEXP_LOGIC }, {\n  startsWith: function startsWith(searchString /* , position = 0 */) {\n    var that = String(requireObjectCoercible(this));\n    notARegExp(searchString);\n    var index = toLength(min(arguments.length > 1 ? arguments[1] : undefined, that.length));\n    var search = String(searchString);\n    return nativeStartsWith\n      ? nativeStartsWith.call(that, search, index)\n      : that.slice(index, index + search.length) === search;\n  }\n});\n","(function(self) {\n\nvar irrelevant = (function (exports) {\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob:\n      'FileReader' in self &&\n      'Blob' in self &&\n      (function() {\n        try {\n          new Blob();\n          return true\n        } catch (e) {\n          return false\n        }\n      })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  };\n\n  function isDataView(obj) {\n    return obj && DataView.prototype.isPrototypeOf(obj)\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ];\n\n    var isArrayBufferView =\n      ArrayBuffer.isView ||\n      function(obj) {\n        return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n      };\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name);\n    }\n    if (/[^a-z0-9\\-#$%&'*+.^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value);\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift();\n        return {done: value === undefined, value: value}\n      }\n    };\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      };\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {};\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value);\n      }, this);\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1]);\n      }, this);\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name]);\n      }, this);\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name);\n    value = normalizeValue(value);\n    var oldValue = this.map[name];\n    this.map[name] = oldValue ? oldValue + ', ' + value : value;\n  };\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)];\n  };\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name);\n    return this.has(name) ? this.map[name] : null\n  };\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  };\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value);\n  };\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this);\n      }\n    }\n  };\n\n  Headers.prototype.keys = function() {\n    var items = [];\n    this.forEach(function(value, name) {\n      items.push(name);\n    });\n    return iteratorFor(items)\n  };\n\n  Headers.prototype.values = function() {\n    var items = [];\n    this.forEach(function(value) {\n      items.push(value);\n    });\n    return iteratorFor(items)\n  };\n\n  Headers.prototype.entries = function() {\n    var items = [];\n    this.forEach(function(value, name) {\n      items.push([name, value]);\n    });\n    return iteratorFor(items)\n  };\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries;\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true;\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result);\n      };\n      reader.onerror = function() {\n        reject(reader.error);\n      };\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsArrayBuffer(blob);\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsText(blob);\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf);\n    var chars = new Array(view.length);\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i]);\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength);\n      view.set(new Uint8Array(buf));\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false;\n\n    this._initBody = function(body) {\n      this._bodyInit = body;\n      if (!body) {\n        this._bodyText = '';\n      } else if (typeof body === 'string') {\n        this._bodyText = body;\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body;\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body;\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString();\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer);\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer]);\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body);\n      } else {\n        this._bodyText = body = Object.prototype.toString.call(body);\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8');\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type);\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');\n        }\n      }\n    };\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this);\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      };\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      };\n    }\n\n    this.text = function() {\n      var rejected = consumed(this);\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    };\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      };\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    };\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT'];\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase();\n    return methods.indexOf(upcased) > -1 ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {};\n    var body = options.body;\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url;\n      this.credentials = input.credentials;\n      if (!options.headers) {\n        this.headers = new Headers(input.headers);\n      }\n      this.method = input.method;\n      this.mode = input.mode;\n      this.signal = input.signal;\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit;\n        input.bodyUsed = true;\n      }\n    } else {\n      this.url = String(input);\n    }\n\n    this.credentials = options.credentials || this.credentials || 'same-origin';\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers);\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET');\n    this.mode = options.mode || this.mode || null;\n    this.signal = options.signal || this.signal;\n    this.referrer = null;\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body);\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, {body: this._bodyInit})\n  };\n\n  function decode(body) {\n    var form = new FormData();\n    body\n      .trim()\n      .split('&')\n      .forEach(function(bytes) {\n        if (bytes) {\n          var split = bytes.split('=');\n          var name = split.shift().replace(/\\+/g, ' ');\n          var value = split.join('=').replace(/\\+/g, ' ');\n          form.append(decodeURIComponent(name), decodeURIComponent(value));\n        }\n      });\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers();\n    // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n    // https://tools.ietf.org/html/rfc7230#section-3.2\n    var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ');\n    preProcessedHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':');\n      var key = parts.shift().trim();\n      if (key) {\n        var value = parts.join(':').trim();\n        headers.append(key, value);\n      }\n    });\n    return headers\n  }\n\n  Body.call(Request.prototype);\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {};\n    }\n\n    this.type = 'default';\n    this.status = options.status === undefined ? 200 : options.status;\n    this.ok = this.status >= 200 && this.status < 300;\n    this.statusText = 'statusText' in options ? options.statusText : 'OK';\n    this.headers = new Headers(options.headers);\n    this.url = options.url || '';\n    this._initBody(bodyInit);\n  }\n\n  Body.call(Response.prototype);\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  };\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''});\n    response.type = 'error';\n    return response\n  };\n\n  var redirectStatuses = [301, 302, 303, 307, 308];\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  };\n\n  exports.DOMException = self.DOMException;\n  try {\n    new exports.DOMException();\n  } catch (err) {\n    exports.DOMException = function(message, name) {\n      this.message = message;\n      this.name = name;\n      var error = Error(message);\n      this.stack = error.stack;\n    };\n    exports.DOMException.prototype = Object.create(Error.prototype);\n    exports.DOMException.prototype.constructor = exports.DOMException;\n  }\n\n  function fetch(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init);\n\n      if (request.signal && request.signal.aborted) {\n        return reject(new exports.DOMException('Aborted', 'AbortError'))\n      }\n\n      var xhr = new XMLHttpRequest();\n\n      function abortXhr() {\n        xhr.abort();\n      }\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        };\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL');\n        var body = 'response' in xhr ? xhr.response : xhr.responseText;\n        resolve(new Response(body, options));\n      };\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.onabort = function() {\n        reject(new exports.DOMException('Aborted', 'AbortError'));\n      };\n\n      xhr.open(request.method, request.url, true);\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true;\n      } else if (request.credentials === 'omit') {\n        xhr.withCredentials = false;\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob';\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value);\n      });\n\n      if (request.signal) {\n        request.signal.addEventListener('abort', abortXhr);\n\n        xhr.onreadystatechange = function() {\n          // DONE (success or failure)\n          if (xhr.readyState === 4) {\n            request.signal.removeEventListener('abort', abortXhr);\n          }\n        };\n      }\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit);\n    })\n  }\n\n  fetch.polyfill = true;\n\n  if (!self.fetch) {\n    self.fetch = fetch;\n    self.Headers = Headers;\n    self.Request = Request;\n    self.Response = Response;\n  }\n\n  exports.Headers = Headers;\n  exports.Request = Request;\n  exports.Response = Response;\n  exports.fetch = fetch;\n\n  return exports;\n\n}({}));\n})(typeof self !== 'undefined' ? self : this);\n","function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _interopRequireDefault;","var _Object$defineProperty = require(\"../core-js/object/define-property\");\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    _Object$defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","var _Object$defineProperty = require(\"../core-js/object/define-property\");\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n\n    _Object$defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","module.exports = require(\"core-js-pure/stable/instance/for-each\");","module.exports = require(\"core-js-pure/features/symbol\");","module.exports = require(\"regenerator-runtime\");\n","var _Promise = require(\"../core-js/promise\");\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    _Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new _Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nmodule.exports = _asyncToGenerator;","module.exports = require(\"core-js-pure/stable/instance/concat\");","module.exports = require(\"core-js-pure/stable/instance/filter\");","module.exports = require(\"core-js-pure/stable/instance/map\");","module.exports = require(\"core-js-pure/stable/instance/slice\");","module.exports = require(\"core-js-pure/stable/object/keys\");","var arrayWithHoles = require(\"./arrayWithHoles\");\n\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableRest = require(\"./nonIterableRest\");\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}\n\nmodule.exports = _slicedToArray;","import BAI from './bai'\nimport CSI from './csi'\nimport BamFile from './bamFile'\nimport HtsgetFile from './htsget'\nimport BamRecord from './record'\n\nexport { BAI, CSI, BamFile, BamRecord, HtsgetFile }\n","module.exports = require(\"core-js-pure/features/get-iterator\");","module.exports = require(\"core-js-pure/features/get-iterator-method\");","module.exports = require(\"core-js-pure/stable/object/define-properties\");","module.exports = require(\"core-js-pure/stable/object/get-own-property-descriptors\");","module.exports = require(\"core-js-pure/stable/object/get-own-property-descriptor\");","module.exports = require(\"core-js-pure/stable/object/get-own-property-symbols\");","module.exports = require(\"core-js-pure/stable/reflect/construct\");","module.exports = require(\"core-js-pure/features/object/define-property\");","module.exports = require(\"core-js-pure/features/promise\");","var _Object$create = require(\"../core-js/object/create\");\n\nvar setPrototypeOf = require(\"./setPrototypeOf\");\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = _Object$create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nmodule.exports = _inherits;","var _typeof = require(\"../helpers/typeof\");\n\nvar assertThisInitialized = require(\"./assertThisInitialized\");\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}\n\nmodule.exports = _possibleConstructorReturn;","module.exports = require(\"core-js-pure/features/symbol/iterator\");","function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nmodule.exports = _assertThisInitialized;","var _Object$getPrototypeOf = require(\"../core-js/object/get-prototype-of\");\n\nvar _Object$setPrototypeOf = require(\"../core-js/object/set-prototype-of\");\n\nfunction _getPrototypeOf(o) {\n  module.exports = _getPrototypeOf = _Object$setPrototypeOf ? _Object$getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || _Object$getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nmodule.exports = _getPrototypeOf;","import Chunk from './chunk'\nimport VirtualOffset from './virtualOffset'\n\nexport function timeout(ms: number) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\nexport function longToNumber(long: Long) {\n  if (long.greaterThan(Number.MAX_SAFE_INTEGER) || long.lessThan(Number.MIN_SAFE_INTEGER)) {\n    throw new Error('integer overflow')\n  }\n  return long.toNumber()\n}\n\n/**\n * Properly check if the given AbortSignal is aborted.\n * Per the standard, if the signal reads as aborted,\n * this function throws either a DOMException AbortError, or a regular error\n * with a `code` attribute set to `ERR_ABORTED`.\n *\n * For convenience, passing `undefined` is a no-op\n *\n * @param {AbortSignal} [signal] an AbortSignal, or anything with an `aborted` attribute\n * @returns nothing\n */\nexport function checkAbortSignal(signal?: AbortSignal) {\n  if (!signal) {\n    return\n  }\n\n  if (signal.aborted) {\n    // console.log('bam aborted!')\n    if (typeof DOMException !== 'undefined') {\n      throw new DOMException('aborted', 'AbortError')\n    } else {\n      const e = new Error('aborted')\n      //@ts-ignore\n      e.code = 'ERR_ABORTED'\n      throw e\n    }\n  }\n}\n\n/**\n * Skips to the next tick, then runs `checkAbortSignal`.\n * Await this to inside an otherwise synchronous loop to\n * provide a place to break when an abort signal is received.\n * @param {AbortSignal} signal\n */\nexport async function abortBreakPoint(signal?: AbortSignal) {\n  await Promise.resolve()\n  checkAbortSignal(signal)\n}\n\nexport function canMergeBlocks(chunk1: Chunk, chunk2: Chunk) {\n  return (\n    chunk2.minv.blockPosition - chunk1.maxv.blockPosition < 65000 &&\n    chunk2.maxv.blockPosition - chunk1.minv.blockPosition < 5000000\n  )\n}\n\nexport interface BamOpts {\n  viewAsPairs?: boolean\n  pairAcrossChr?: boolean\n  maxInsertSize?: number\n  signal?: AbortSignal\n}\n\nexport interface BaseOpts {\n  signal?: AbortSignal\n}\n\nexport function makeOpts(obj: AbortSignal | BaseOpts = {}): BaseOpts {\n  return 'aborted' in obj ? ({ signal: obj } as BaseOpts) : (obj as BaseOpts)\n}\n\nexport function optimizeChunks(chunks: Chunk[], lowest: VirtualOffset) {\n  const mergedChunks: Chunk[] = []\n  let lastChunk: Chunk | null = null\n\n  if (chunks.length === 0) {\n    return chunks\n  }\n\n  chunks.sort(function(c0, c1) {\n    const dif = c0.minv.blockPosition - c1.minv.blockPosition\n    if (dif !== 0) {\n      return dif\n    } else {\n      return c0.minv.dataPosition - c1.minv.dataPosition\n    }\n  })\n\n  chunks.forEach(chunk => {\n    if (!lowest || chunk.maxv.compareTo(lowest) > 0) {\n      if (lastChunk === null) {\n        mergedChunks.push(chunk)\n        lastChunk = chunk\n      } else {\n        if (canMergeBlocks(lastChunk, chunk)) {\n          if (chunk.maxv.compareTo(lastChunk.maxv) > 0) {\n            lastChunk.maxv = chunk.maxv\n          }\n        } else {\n          mergedChunks.push(chunk)\n          lastChunk = chunk\n        }\n      }\n    }\n  })\n\n  return mergedChunks\n}\n","module.exports = require(\"core-js-pure/stable/promise\");"],"sourceRoot":""}